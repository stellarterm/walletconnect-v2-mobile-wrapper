!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("WalletConnectClient",[],t):"object"==typeof exports?exports.WalletConnectClient=t():e.WalletConnectClient=t()}(this,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var i=t[r]={i:r,l:!1,exports:{}};return e[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)n.d(r,i,function(t){return e[t]}.bind(null,i));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=70)}([function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"h",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"g",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"n",(function(){return d})),n.d(t,"o",(function(){return l})),n.d(t,"j",(function(){return f})),n.d(t,"i",(function(){return h})),n.d(t,"m",(function(){return p})),n.d(t,"e",(function(){return g})),n.d(t,"k",(function(){return r})),n.d(t,"l",(function(){return i})),n.d(t,"d",(function(){return y})),n.d(t,"c",(function(){return E})),n.d(t,"p",(function(){return _})),n.d(t,"q",(function(){return v}));const r=0,i=512,o=256,s=256,a="AES-CBC",c="SHA-"+o,u="HMAC",d="SHA-256",l="SHA-512",f=32,h=16,p=32,g="Bad MAC",y="encrypt",E="decrypt",_="sign",v="verify"},function(e,t,n){"use strict";(function(e){var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.removeHexLeadingZeros=t.sanitizeHex=t.addHexPrefix=t.removeHexPrefix=t.padRight=t.padLeft=t.sanitizeBytes=t.swapHex=t.swapBytes=t.splitBytes=t.calcByteLength=t.trimRight=t.trimLeft=t.concatArrays=t.concatBuffers=t.getEncoding=t.getType=t.isArrayBuffer=t.isTypedArray=t.isBuffer=t.isHexString=t.isBinaryString=t.binaryToNumber=t.binaryToUtf8=t.binaryToHex=t.binaryToArray=t.binaryToBuffer=t.numberToBinary=t.numberToUtf8=t.numberToHex=t.numberToArray=t.numberToBuffer=t.utf8ToBinary=t.utf8ToNumber=t.utf8ToHex=t.utf8ToArray=t.utf8ToBuffer=t.hexToBinary=t.hexToNumber=t.hexToUtf8=t.hexToArray=t.hexToBuffer=t.arrayToBinary=t.arrayToNumber=t.arrayToUtf8=t.arrayToHex=t.arrayToBuffer=t.bufferToBinary=t.bufferToNumber=t.bufferToUtf8=t.bufferToHex=t.bufferToArray=void 0;const i=r(n(56)),o=r(n(85));function s(e){return new Uint8Array(e)}function a(e,t=!1){const n=e.toString("hex");return t?M(n):n}function c(e){return e.toString("utf8")}function u(e){return e.readUIntBE(0,e.length)}function d(e){return o.default(e)}function l(e,t=!1){return a(d(e),t)}function f(e){return c(d(e))}function h(e){return u(d(e))}function p(e){return Array.from(e).map(m).join("")}function g(t){return e.from(L(t),"hex")}function y(e){return s(g(e))}function E(e){return p(y(e))}function _(t){return e.from(t,"utf8")}function v(e){return s(_(e))}function m(e){return U((e>>>0).toString(2))}function R(e){return d(S(e))}function S(e){return new Uint8Array(P(e).map(e=>parseInt(e,2)))}function T(e,t){return l(S(e),t)}function O(e){return!("string"!=typeof e||!new RegExp(/^[01]+$/).test(e))&&e.length%8==0}function b(e,t){return!("string"!=typeof e||!e.match(/^0x[0-9A-Fa-f]*$/))&&(!t||e.length===2+2*t)}function N(t){return e.isBuffer(t)}function I(e){return i.default.strict(e)&&!N(e)}function w(e){return!I(e)&&!N(e)&&void 0!==e.byteLength}function A(e,t=8){const n=e%t;return n?(e-n)/t*t+t:e}function P(e,t=8){const n=U(e).match(new RegExp(`.{${t}}`,"gi"));return Array.from(n||[])}function C(e){return P(e).map(x).join("")}function U(e,t=8,n="0"){return D(e,A(e.length,t),n)}function D(e,t,n="0"){return j(e,t,!0,n)}function L(e){return e.replace(/^0x/,"")}function M(e){return e.startsWith("0x")?e:"0x"+e}function x(e){return e.split("").reverse().join("")}function j(e,t,n,r="0"){const i=t-e.length;let o=e;if(i>0){const t=r.repeat(i);o=n?t+e:e+t}return o}t.bufferToArray=s,t.bufferToHex=a,t.bufferToUtf8=c,t.bufferToNumber=u,t.bufferToBinary=function(e){return p(s(e))},t.arrayToBuffer=d,t.arrayToHex=l,t.arrayToUtf8=f,t.arrayToNumber=h,t.arrayToBinary=p,t.hexToBuffer=g,t.hexToArray=y,t.hexToUtf8=function(e){return c(g(e))},t.hexToNumber=function(e){return h(y(e))},t.hexToBinary=E,t.utf8ToBuffer=_,t.utf8ToArray=v,t.utf8ToHex=function(e,t=!1){return a(_(e),t)},t.utf8ToNumber=function(e){const t=parseInt(e,10);return function(e,t){if(!e)throw new Error(t)}(!function(e){return void 0===e}(t),"Number can only safely store up to 53 bits"),t},t.utf8ToBinary=function(e){return p(v(e))},t.numberToBuffer=function(e){return R(m(e))},t.numberToArray=function(e){return S(m(e))},t.numberToHex=function(e,t){return T(m(e),t)},t.numberToUtf8=function(e){return""+e},t.numberToBinary=m,t.binaryToBuffer=R,t.binaryToArray=S,t.binaryToHex=T,t.binaryToUtf8=function(e){return f(S(e))},t.binaryToNumber=function(e){return h(S(e))},t.isBinaryString=O,t.isHexString=b,t.isBuffer=N,t.isTypedArray=I,t.isArrayBuffer=w,t.getType=function(e){return N(e)?"buffer":I(e)?"typed-array":w(e)?"array-buffer":Array.isArray(e)?"array":typeof e},t.getEncoding=function(e){return O(e)?"binary":b(e)?"hex":"utf8"},t.concatBuffers=function(...t){return e.concat(t)},t.concatArrays=function(...e){let t=[];return e.forEach(e=>t=t.concat(Array.from(e))),new Uint8Array([...t])},t.trimLeft=function(e,t){const n=e.length-t;return n>0&&(e=e.slice(n)),e},t.trimRight=function(e,t){return e.slice(0,t)},t.calcByteLength=A,t.splitBytes=P,t.swapBytes=C,t.swapHex=function(e){return T(C(E(e)))},t.sanitizeBytes=U,t.padLeft=D,t.padRight=function(e,t,n="0"){return j(e,t,!1,n)},t.removeHexPrefix=L,t.addHexPrefix=M,t.sanitizeHex=function(e){return(e=U(e=L(e),2))&&(e=M(e)),e},t.removeHexLeadingZeros=function(e){const t=e.startsWith("0x");return e=(e=L(e)).startsWith("0")?e.substring(1):e,t?M(e):e}}).call(this,n(55).Buffer)},function(e,t,n){"use strict";var r=n(45);n.d(t,"randomBytes",(function(){return r.a}));var i=n(47);n.d(t,"aesCbcDecrypt",(function(){return i.a})),n.d(t,"aesCbcEncrypt",(function(){return i.b}));var o=n(48);n.d(t,"hmacSha256Sign",(function(){return o.a})),n.d(t,"hmacSha256Verify",(function(){return o.b}));var s=n(53);n.d(t,"sha256",(function(){return s.a})),n.d(t,"sha512",(function(){return s.b}));var a=n(26);n.o(a,"ERROR_BAD_MAC")&&n.d(t,"ERROR_BAD_MAC",(function(){return a.ERROR_BAD_MAC})),n.o(a,"IV_LENGTH")&&n.d(t,"IV_LENGTH",(function(){return a.IV_LENGTH})),n.o(a,"KEY_LENGTH")&&n.d(t,"KEY_LENGTH",(function(){return a.KEY_LENGTH})),n.o(a,"LENGTH_0")&&n.d(t,"LENGTH_0",(function(){return a.LENGTH_0})),n.o(a,"MAC_LENGTH")&&n.d(t,"MAC_LENGTH",(function(){return a.MAC_LENGTH})),n.o(a,"assert")&&n.d(t,"assert",(function(){return a.assert})),n.o(a,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return a.decryptWithSharedKey})),n.o(a,"derive")&&n.d(t,"derive",(function(){return a.derive})),n.o(a,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return a.encryptWithSharedKey})),n.o(a,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return a.generateKeyPair}));var c=n(0);n.d(t,"ERROR_BAD_MAC",(function(){return c.e})),n.d(t,"IV_LENGTH",(function(){return c.i})),n.d(t,"KEY_LENGTH",(function(){return c.j})),n.d(t,"LENGTH_0",(function(){return c.k})),n.d(t,"MAC_LENGTH",(function(){return c.m}))},function(e,t,n){"use strict";n.d(t,"e",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"g",(function(){return c})),n.d(t,"f",(function(){return u})),n.d(t,"h",(function(){return d})),n.d(t,"i",(function(){return l}));const r="PARSE_ERROR",i="INVALID_REQUEST",o="METHOD_NOT_FOUND",s="INVALID_PARAMS",a="INTERNAL_ERROR",c="SERVER_ERROR",u=[-32700,-32600,-32601,-32602,-32603],d=[-32e3,-32099],l={[r]:{code:-32700,message:"Parse error"},[i]:{code:-32600,message:"Invalid Request"},[o]:{code:-32601,message:"Method not found"},[s]:{code:-32602,message:"Invalid params"},[a]:{code:-32603,message:"Internal error"},[c]:{code:-32e3,message:"Server error"}}},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(80),t),i(n(81),t)},function(e,t,n){"use strict";function r(e,t,n="string"){if(!e[t]||typeof e[t]!==n)throw new Error(`Missing or invalid "${t}" param`)}function i(e,t){return Array.isArray(e)?e.length===t:Object.keys(e).length===t}function o(e,t,n="_"){const r=e.split(n);return r[r.length-1].trim().toLowerCase()===t.trim().toLowerCase()}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i})),n.d(t,"c",(function(){return o}))},function(e,t,n){"use strict";n.r(t);var r=n(3);n.d(t,"PARSE_ERROR",(function(){return r.e})),n.d(t,"INVALID_REQUEST",(function(){return r.c})),n.d(t,"METHOD_NOT_FOUND",(function(){return r.d})),n.d(t,"INVALID_PARAMS",(function(){return r.b})),n.d(t,"INTERNAL_ERROR",(function(){return r.a})),n.d(t,"SERVER_ERROR",(function(){return r.g})),n.d(t,"RESERVED_ERROR_CODES",(function(){return r.f})),n.d(t,"SERVER_ERROR_CODE_RANGE",(function(){return r.h})),n.d(t,"STANDARD_ERROR_MAP",(function(){return r.i}));var i=n(18);n.d(t,"isServerErrorCode",(function(){return i.d})),n.d(t,"isReservedErrorCode",(function(){return i.c})),n.d(t,"isValidErrorCode",(function(){return i.e})),n.d(t,"getError",(function(){return i.a})),n.d(t,"getErrorByCode",(function(){return i.b})),n.d(t,"validateJsonRpcError",(function(){return i.g})),n.d(t,"parseConnectionError",(function(){return i.f}));var o=n(59);for(var s in o)["default","PARSE_ERROR","INVALID_REQUEST","METHOD_NOT_FOUND","INVALID_PARAMS","INTERNAL_ERROR","SERVER_ERROR","RESERVED_ERROR_CODES","SERVER_ERROR_CODE_RANGE","STANDARD_ERROR_MAP","isServerErrorCode","isReservedErrorCode","isValidErrorCode","getError","getErrorByCode","validateJsonRpcError","parseConnectionError"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return o[e]}))}(s);var a=n(60);n.d(t,"payloadId",(function(){return a.e})),n.d(t,"formatJsonRpcRequest",(function(){return a.c})),n.d(t,"formatJsonRpcResult",(function(){return a.d})),n.d(t,"formatJsonRpcError",(function(){return a.b})),n.d(t,"formatErrorMessage",(function(){return a.a}));var c=n(61);n.d(t,"isValidRoute",(function(){return c.c})),n.d(t,"isValidDefaultRoute",(function(){return c.a})),n.d(t,"isValidWildcardRoute",(function(){return c.e})),n.d(t,"isValidLeadingWildcardRoute",(function(){return c.b})),n.d(t,"isValidTrailingWildcardRoute",(function(){return c.d}));var u=n(62);for(var s in u)["default","PARSE_ERROR","INVALID_REQUEST","METHOD_NOT_FOUND","INVALID_PARAMS","INTERNAL_ERROR","SERVER_ERROR","RESERVED_ERROR_CODES","SERVER_ERROR_CODE_RANGE","STANDARD_ERROR_MAP","isServerErrorCode","isReservedErrorCode","isValidErrorCode","getError","getErrorByCode","validateJsonRpcError","parseConnectionError","payloadId","formatJsonRpcRequest","formatJsonRpcResult","formatJsonRpcError","formatErrorMessage","isValidRoute","isValidDefaultRoute","isValidWildcardRoute","isValidLeadingWildcardRoute","isValidTrailingWildcardRoute"].indexOf(s)<0&&function(e){n.d(t,e,(function(){return u[e]}))}(s);var d=n(63);n.d(t,"isHttpUrl",(function(){return d.a})),n.d(t,"isWsUrl",(function(){return d.c})),n.d(t,"isLocalhostUrl",(function(){return d.b}));var l=n(64);n.d(t,"isJsonRpcPayload",(function(){return l.b})),n.d(t,"isJsonRpcRequest",(function(){return l.c})),n.d(t,"isJsonRpcResponse",(function(){return l.d})),n.d(t,"isJsonRpcResult",(function(){return l.e})),n.d(t,"isJsonRpcError",(function(){return l.a})),n.d(t,"isJsonRpcValidationInvalid",(function(){return l.f}))},function(e,t,n){"use strict";n.r(t);var r=n(34);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(25);n.d(t,"IEvents",(function(){return o.a}));var s=n(35);n.d(t,"IJsonRpcConnection",(function(){return s.b})),n.d(t,"IBaseJsonRpcProvider",(function(){return s.a})),n.d(t,"IJsonRpcProvider",(function(){return s.c}));var a=n(36);for(var i in a)["default","IEvents","IJsonRpcConnection","IBaseJsonRpcProvider","IJsonRpcProvider"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(i)},function(e,t,n){"use strict";n.r(t),n.d(t,"__extends",(function(){return i})),n.d(t,"__assign",(function(){return o})),n.d(t,"__rest",(function(){return s})),n.d(t,"__decorate",(function(){return a})),n.d(t,"__param",(function(){return c})),n.d(t,"__metadata",(function(){return u})),n.d(t,"__awaiter",(function(){return d})),n.d(t,"__generator",(function(){return l})),n.d(t,"__createBinding",(function(){return f})),n.d(t,"__exportStar",(function(){return h})),n.d(t,"__values",(function(){return p})),n.d(t,"__read",(function(){return g})),n.d(t,"__spread",(function(){return y})),n.d(t,"__spreadArrays",(function(){return E})),n.d(t,"__await",(function(){return _})),n.d(t,"__asyncGenerator",(function(){return v})),n.d(t,"__asyncDelegator",(function(){return m})),n.d(t,"__asyncValues",(function(){return R})),n.d(t,"__makeTemplateObject",(function(){return S})),n.d(t,"__importStar",(function(){return T})),n.d(t,"__importDefault",(function(){return O})),n.d(t,"__classPrivateFieldGet",(function(){return b})),n.d(t,"__classPrivateFieldSet",(function(){return N}));
/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */
var r=function(e,t){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)t.hasOwnProperty(n)&&(e[n]=t[n])})(e,t)};function i(e,t){function n(){this.constructor=e}r(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}var o=function(){return(o=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function s(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(r=Object.getOwnPropertySymbols(e);i<r.length;i++)t.indexOf(r[i])<0&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]])}return n}function a(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function c(e,t){return function(n,r){t(n,r,e)}}function u(e,t){if("object"==typeof Reflect&&"function"==typeof Reflect.metadata)return Reflect.metadata(e,t)}function d(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function l(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!(i=s.trys,(i=i.length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function f(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}function h(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||(t[n]=e[n])}function p(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function g(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function y(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(g(arguments[t]));return e}function E(){for(var e=0,t=0,n=arguments.length;t<n;t++)e+=arguments[t].length;var r=Array(e),i=0;for(t=0;t<n;t++)for(var o=arguments[t],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}function _(e){return this instanceof _?(this.v=e,this):new _(e)}function v(e,t,n){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r,i=n.apply(e,t||[]),o=[];return r={},s("next"),s("throw"),s("return"),r[Symbol.asyncIterator]=function(){return this},r;function s(e){i[e]&&(r[e]=function(t){return new Promise((function(n,r){o.push([e,t,n,r])>1||a(e,t)}))})}function a(e,t){try{(n=i[e](t)).value instanceof _?Promise.resolve(n.value.v).then(c,u):d(o[0][2],n)}catch(e){d(o[0][3],e)}var n}function c(e){a("next",e)}function u(e){a("throw",e)}function d(e,t){e(t),o.shift(),o.length&&a(o[0][0],o[0][1])}}function m(e){var t,n;return t={},r("next"),r("throw",(function(e){throw e})),r("return"),t[Symbol.iterator]=function(){return this},t;function r(r,i){t[r]=e[r]?function(t){return(n=!n)?{value:_(e[r](t)),done:"return"===r}:i?i(t):t}:i}}function R(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var t,n=e[Symbol.asyncIterator];return n?n.call(e):(e=p(e),t={},r("next"),r("throw"),r("return"),t[Symbol.asyncIterator]=function(){return this},t);function r(n){t[n]=e[n]&&function(t){return new Promise((function(r,i){(function(e,t,n,r){Promise.resolve(r).then((function(t){e({value:t,done:n})}),t)})(r,i,(t=e[n](t)).done,t.value)}))}}}function S(e,t){return Object.defineProperty?Object.defineProperty(e,"raw",{value:t}):e.raw=t,e}function T(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)Object.hasOwnProperty.call(e,n)&&(t[n]=e[n]);return t.default=e,t}function O(e){return e&&e.__esModule?e:{default:e}}function b(e,t){if(!t.has(e))throw new TypeError("attempted to get private field on non-instance");return t.get(e)}function N(e,t,n){if(!t.has(e))throw new TypeError("attempted to set private field on non-instance");return t.set(e,n),n}},function(e,t,n){"use strict";n.d(t,"b",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return c})),n.d(t,"d",(function(){return u})),n.d(t,"e",(function(){return d})),n.d(t,"f",(function(){return l}));var r=n(4),i=n(0);async function o(e,t=i.a){return r.getSubtleCrypto().importKey("raw",e,function(e){return e===i.a?{length:i.b,name:i.a}:{hash:{name:i.g},name:i.f}}(t),!0,function(e){return e===i.a?[i.d,i.c]:[i.p,i.q]}(t))}async function s(e,t,n){const s=r.getSubtleCrypto(),a=await o(t,i.a),c=await s.encrypt({iv:e,name:i.a},a,n);return new Uint8Array(c)}async function a(e,t,n){const s=r.getSubtleCrypto(),a=await o(t,i.a),c=await s.decrypt({iv:e,name:i.a},a,n);return new Uint8Array(c)}async function c(e,t){const n=r.getSubtleCrypto(),s=await o(e,i.f),a=await n.sign({length:i.h,name:i.f},s,t);return new Uint8Array(a)}async function u(e,t){const n=r.getSubtleCrypto(),s=await o(e,i.f),a=await n.sign({length:i.l,name:i.f},s,t);return new Uint8Array(a)}async function d(e){const t=r.getSubtleCrypto(),n=await t.digest({name:i.n},e);return new Uint8Array(n)}async function l(e){const t=r.getSubtleCrypto(),n=await t.digest({name:i.o},e);return new Uint8Array(n)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return s})),n.d(t,"c",(function(){return a})),n.d(t,"f",(function(){return c})),n.d(t,"g",(function(){return u})),n.d(t,"d",(function(){return d})),n.d(t,"e",(function(){return l})),n.d(t,"h",(function(){return f})),n.d(t,"b",(function(){return h}));var r=n(31),i=n(1),o=n(2);function s(e,t){return r.sharedKey(e,t)}function a(e){const t=void 0!==e?function(e){return{isAvailable:!0,randomBytes:()=>e}}(e):void 0,n=r.generateKeyPair(t);return{publicKey:n.publicKey,privateKey:n.secretKey}}function c(e){const t=(null==e?void 0:e.sender)||a();return{privateKey:t.privateKey,publicKey:t.publicKey}}function u(e,t){return s(e,t)}function d(e){return new Uint8Array(e.slice(o.LENGTH_0,o.KEY_LENGTH))}function l(e){return new Uint8Array(e.slice(o.KEY_LENGTH))}function f(e){return Object(i.concatArrays)(e.iv,e.publicKey,e.mac,e.ciphertext)}function h(e){const t=o.LENGTH_0,n=t+o.IV_LENGTH,r=n+o.KEY_LENGTH,i=r+o.MAC_LENGTH,s=e.length;return{iv:e.slice(t,n),publicKey:e.slice(n,r),mac:e.slice(r,i),ciphertext:e.slice(i,s)}}},function(e,t,n){"use strict";n.d(t,"f",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return c})),n.d(t,"b",(function(){return u})),n.d(t,"l",(function(){return d})),n.d(t,"j",(function(){return l})),n.d(t,"k",(function(){return f})),n.d(t,"i",(function(){return h})),n.d(t,"g",(function(){return p})),n.d(t,"h",(function(){return g}));var r=n(5);function i(e){return o(e.method)&&s(e.params)}function o(e){return Object(r.c)(e,"subscribe")}function s(e){return Object(r.b)(e,1)&&"topic"in e}function a(e){return c(e.method)&&u(e.params)}function c(e){return Object(r.c)(e,"publish")}function u(e){return Object(r.b)(e,3)&&"message"in e&&"topic"in e&&"ttl"in e}function d(e){return l(e.method)&&f(e.params)}function l(e){return Object(r.c)(e,"unsubscribe")}function f(e){return Object(r.b)(e,2)&&"id"in e&&"topic"in e}function h(e){return p(e.method)&&g(e.params)}function p(e){return Object(r.c)(e,"subscription")}function g(e){return Object(r.b)(e,2)&&"id"in e&&"data"in e}},function(e,t,n){"use strict";var r,i="object"==typeof Reflect?Reflect:null,o=i&&"function"==typeof i.apply?i.apply:function(e,t,n){return Function.prototype.apply.call(e,t,n)};r=i&&"function"==typeof i.ownKeys?i.ownKeys:Object.getOwnPropertySymbols?function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:function(e){return Object.getOwnPropertyNames(e)};var s=Number.isNaN||function(e){return e!=e};function a(){a.init.call(this)}e.exports=a,e.exports.once=function(e,t){return new Promise((function(n,r){function i(n){e.removeListener(t,o),r(n)}function o(){"function"==typeof e.removeListener&&e.removeListener("error",i),n([].slice.call(arguments))}E(e,t,o,{once:!0}),"error"!==t&&function(e,t,n){"function"==typeof e.on&&E(e,"error",t,n)}(e,i,{once:!0})}))},a.EventEmitter=a,a.prototype._events=void 0,a.prototype._eventsCount=0,a.prototype._maxListeners=void 0;var c=10;function u(e){if("function"!=typeof e)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof e)}function d(e){return void 0===e._maxListeners?a.defaultMaxListeners:e._maxListeners}function l(e,t,n,r){var i,o,s,a;if(u(n),void 0===(o=e._events)?(o=e._events=Object.create(null),e._eventsCount=0):(void 0!==o.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),o=e._events),s=o[t]),void 0===s)s=o[t]=n,++e._eventsCount;else if("function"==typeof s?s=o[t]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(i=d(e))>0&&s.length>i&&!s.warned){s.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(t)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=s.length,a=c,console&&console.warn&&console.warn(a)}return e}function f(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function h(e,t,n){var r={fired:!1,wrapFn:void 0,target:e,type:t,listener:n},i=f.bind(r);return i.listener=n,r.wrapFn=i,i}function p(e,t,n){var r=e._events;if(void 0===r)return[];var i=r[t];return void 0===i?[]:"function"==typeof i?n?[i.listener||i]:[i]:n?function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(i):y(i,i.length)}function g(e){var t=this._events;if(void 0!==t){var n=t[e];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function y(e,t){for(var n=new Array(t),r=0;r<t;++r)n[r]=e[r];return n}function E(e,t,n,r){if("function"==typeof e.on)r.once?e.once(t,n):e.on(t,n);else{if("function"!=typeof e.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof e);e.addEventListener(t,(function i(o){r.once&&e.removeEventListener(t,i),n(o)}))}}Object.defineProperty(a,"defaultMaxListeners",{enumerable:!0,get:function(){return c},set:function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+e+".");c=e}}),a.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},a.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||s(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this},a.prototype.getMaxListeners=function(){return d(this)},a.prototype.emit=function(e){for(var t=[],n=1;n<arguments.length;n++)t.push(arguments[n]);var r="error"===e,i=this._events;if(void 0!==i)r=r&&void 0===i.error;else if(!r)return!1;if(r){var s;if(t.length>0&&(s=t[0]),s instanceof Error)throw s;var a=new Error("Unhandled error."+(s?" ("+s.message+")":""));throw a.context=s,a}var c=i[e];if(void 0===c)return!1;if("function"==typeof c)o(c,this,t);else{var u=c.length,d=y(c,u);for(n=0;n<u;++n)o(d[n],this,t)}return!0},a.prototype.addListener=function(e,t){return l(this,e,t,!1)},a.prototype.on=a.prototype.addListener,a.prototype.prependListener=function(e,t){return l(this,e,t,!0)},a.prototype.once=function(e,t){return u(t),this.on(e,h(this,e,t)),this},a.prototype.prependOnceListener=function(e,t){return u(t),this.prependListener(e,h(this,e,t)),this},a.prototype.removeListener=function(e,t){var n,r,i,o,s;if(u(t),void 0===(r=this._events))return this;if(void 0===(n=r[e]))return this;if(n===t||n.listener===t)0==--this._eventsCount?this._events=Object.create(null):(delete r[e],r.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,o=n.length-1;o>=0;o--)if(n[o]===t||n[o].listener===t){s=n[o].listener,i=o;break}if(i<0)return this;0===i?n.shift():function(e,t){for(;t+1<e.length;t++)e[t]=e[t+1];e.pop()}(n,i),1===n.length&&(r[e]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",e,s||t)}return this},a.prototype.off=a.prototype.removeListener,a.prototype.removeAllListeners=function(e){var t,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[e]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[e]),this;if(0===arguments.length){var i,o=Object.keys(n);for(r=0;r<o.length;++r)"removeListener"!==(i=o[r])&&this.removeAllListeners(i);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(void 0!==t)for(r=t.length-1;r>=0;r--)this.removeListener(e,t[r]);return this},a.prototype.listeners=function(e){return p(this,e,!0)},a.prototype.rawListeners=function(e){return p(this,e,!1)},a.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):g.call(e,t)},a.prototype.listenerCount=g,a.prototype.eventNames=function(){return this._eventsCount>0?r(this._events):[]}},function(e,t,n){"use strict";(function(e){n.d(t,"l",(function(){return s})),n.d(t,"m",(function(){return a})),n.d(t,"k",(function(){return c})),n.d(t,"h",(function(){return u})),n.d(t,"a",(function(){return d})),n.d(t,"g",(function(){return l})),n.d(t,"i",(function(){return f})),n.d(t,"f",(function(){return h})),n.d(t,"b",(function(){return p})),n.d(t,"j",(function(){return g})),n.d(t,"o",(function(){return y})),n.d(t,"p",(function(){return E})),n.d(t,"n",(function(){return _})),n.d(t,"e",(function(){return v})),n.d(t,"d",(function(){return m})),n.d(t,"c",(function(){return R}));var r=n(23),i=n(69),o=n(24);function s(){return void 0!==e&&void 0!==e.versions&&void 0!==e.versions.node}function a(){return!Object(o.getDocument)()&&!!Object(o.getNavigator)()&&"ReactNative"===navigator.product}function c(){return!s()&&!!Object(o.getNavigator)()}function u(){return a()?"react-native":s()?"node":c()?"browser":"unknown"}function d(e,t){let n=r.parse(e);return n=Object.assign(Object.assign({},n),t),e=r.stringify(n)}function l(){return Object(i.getWindowMetadata)()||void 0}function f(e,t){var n;const r=u(),i={protocol:e,version:t,env:r};return"browser"===r&&(i.host=(null===(n=Object(o.getLocation)())||void 0===n?void 0:n.host)||""),i}function h(e,t,n){const r=n.split("?"),i=f(e,t),o=d(r[1]||"",i);return r[0]+"?"+o}function p(e,t,n){if(!e[t]||typeof e[t]!==n)throw new Error(`Missing or invalid "${t}" param`)}function g(e,t){return e.filter(e=>t.includes(e)).length===e.length}function y(e){return Object.fromEntries(e.entries())}function E(e){return new Map(Object.entries(e))}function _(e,t){const n={};return Object.keys(e).forEach(r=>{n[r]=t(e[r])}),n}const v=e=>e;function m(e){return e.trim().replace(/^\w/,e=>e.toUpperCase())}function R(e){return e.split(" ").map(e=>m(e)).join(" ")}}).call(this,n(46))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(8);r.__exportStar(n(100),t),r.__exportStar(n(101),t),r.__exportStar(n(102),t),r.__exportStar(n(103),t),r.__exportStar(n(104),t),r.__exportStar(n(105),t),r.__exportStar(n(106),t),r.__exportStar(n(21),t)},function(e,t,n){"use strict";n.r(t),n.d(t,"generateKeyPair",(function(){return o})),n.d(t,"generateRandomBytes32",(function(){return s})),n.d(t,"deriveSharedKey",(function(){return a})),n.d(t,"sha256",(function(){return c})),n.d(t,"encrypt",(function(){return u})),n.d(t,"decrypt",(function(){return d})),n.d(t,"ERROR_TYPE",(function(){return f})),n.d(t,"ERROR",(function(){return E})),n.d(t,"isNode",(function(){return l.l})),n.d(t,"isReactNative",(function(){return l.m})),n.d(t,"isBrowser",(function(){return l.k})),n.d(t,"getEnvironment",(function(){return l.h})),n.d(t,"appendToQueryString",(function(){return l.a})),n.d(t,"getAppMetadata",(function(){return l.g})),n.d(t,"getRelayClientMetadata",(function(){return l.i})),n.d(t,"formatRelayRpcUrl",(function(){return l.f})),n.d(t,"assertType",(function(){return l.b})),n.d(t,"hasOverlap",(function(){return l.j})),n.d(t,"mapToObj",(function(){return l.o})),n.d(t,"objToMap",(function(){return l.p})),n.d(t,"mapEntries",(function(){return l.n})),n.d(t,"enumify",(function(){return l.e})),n.d(t,"capitalizeWord",(function(){return l.d})),n.d(t,"capitalize",(function(){return l.c})),n.d(t,"formatUri",(function(){return m})),n.d(t,"parseUri",(function(){return R})),n.d(t,"isSignalTypePairing",(function(){return S})),n.d(t,"isSignalTypeUri",(function(){return T})),n.d(t,"isSequenceRespondedStatus",(function(){return O})),n.d(t,"isSequenceResponded",(function(){return b})),n.d(t,"isSequenceFailed",(function(){return N})),n.d(t,"isPairingRespondedStatus",(function(){return I})),n.d(t,"isPairingResponded",(function(){return w})),n.d(t,"isPairingFailed",(function(){return A})),n.d(t,"isSessionRespondedStatus",(function(){return P})),n.d(t,"isSessionResponded",(function(){return C})),n.d(t,"isSessionFailed",(function(){return U})),n.d(t,"isSubscriptionUpdatedEvent",(function(){return D})),n.d(t,"validateSessionProposeParamsPermissions",(function(){return L})),n.d(t,"validateSessionProposeParamsMetadata",(function(){return M})),n.d(t,"validateSessionProposeParams",(function(){return x})),n.d(t,"validateSessionRespondParams",(function(){return j})),n.d(t,"validateBlockchainPermissions",(function(){return q})),n.d(t,"validateJsonRpcPermissions",(function(){return H})),n.d(t,"validateNotificationPermissions",(function(){return K})),n.d(t,"validateBlockchainState",(function(){return G})),n.d(t,"isValidArray",(function(){return V})),n.d(t,"isValidString",(function(){return B})),n.d(t,"isValidChainId",(function(){return Y})),n.d(t,"isValidAccountId",(function(){return J})),n.d(t,"isValidUrl",(function(){return k})),n.d(t,"isValidationInvalid",(function(){return F})),n.d(t,"formatValidResult",(function(){return W})),n.d(t,"formatInvalidResult",(function(){return z}));var r=n(19),i=n(1);function o(){const e=r.generateKeyPair();return{privateKey:i.arrayToHex(e.privateKey),publicKey:i.arrayToHex(e.publicKey)}}function s(){return i.arrayToHex(r.randomBytes(32))}function a(e,t){const n=r.derive(i.hexToArray(e),i.hexToArray(t));return i.arrayToHex(n)}async function c(e){const t=await r.sha256(i.hexToArray(e));return i.arrayToHex(t)}async function u(e){const t=i.utf8ToArray(e.message),n=i.hexToArray(e.sharedKey),o=i.hexToArray(e.publicKey),s=void 0!==e.iv?i.hexToArray(e.iv):void 0,a=await r.encryptWithSharedKey(t,n,o,s);return i.arrayToHex(a)}async function d(e){const t=i.hexToArray(e.encrypted),n=i.hexToArray(e.sharedKey),o=await r.decryptWithSharedKey(t,n);return i.arrayToUtf8(o)}var l=n(13);const f=Object(l.e)({GENERIC:"GENERIC",MISSING_OR_INVALID:"MISSING_OR_INVALID",MISSING_RESPONSE:"MISSING_RESPONSE",MISSING_DECRYPT_PARAMS:"MISSING_DECRYPT_PARAMS",INVALID_UPDATE_REQUEST:"INVALID_UPDATE_REQUEST",INVALID_UPGRADE_REQUEST:"INVALID_UPGRADE_REQUEST",RECORD_ALREADY_EXISTS:"RECORD_ALREADY_EXISTS",RESTORE_WILL_OVERRIDE:"RESTORE_WILL_OVERRIDE",NO_MATCHING_ID:"NO_MATCHING_ID",NO_MATCHING_TOPIC:"NO_MATCHING_TOPIC",NO_MATCHING_RESPONSE:"NO_MATCHING_RESPONSE",NO_MATCHING_KEY:"NO_MATCHING_KEY",UNKNOWN_JSONRPC_METHOD:"UNKNOWN_JSONRPC_METHOD",MISMATCHED_TOPIC:"MISMATCHED_TOPIC",MISMATCHED_ACCOUNTS:"MISMATCHED_ACCOUNTS",SETTLED:"SETTLED",NOT_APPROVED:"NOT_APPROVED",PROPOSAL_RESPONDED:"PROPOSAL_RESPONDED",RESPONSE_ACKNOWLEDGED:"RESPONSE_ACKNOWLEDGED",EXPIRED:"EXPIRED",SETTLE_TIMEOUT:"SETTLE_TIMEOUT",JSONRPC_REQUEST_TIMEOUT:"JSONRPC_REQUEST_TIMEOUT",UNAUTHORIZED_TARGET_CHAIN:"UNAUTHORIZED_TARGET_CHAIN",UNAUTHORIZED_JSON_RPC_METHOD:"UNAUTHORIZED_JSON_RPC_METHOD",UNAUTHORIZED_NOTIFICATION_TYPE:"UNAUTHORIZED_NOTIFICATION_TYPE",UNAUTHORIZED_UPDATE_REQUEST:"UNAUTHORIZED_UPDATE_REQUEST",UNAUTHORIZED_UPGRADE_REQUEST:"UNAUTHORIZED_UPGRADE_REQUEST",UNAUTHORIZED_MATCHING_CONTROLLER:"UNAUTHORIZED_MATCHING_CONTROLLER",JSONRPC_REQUEST_METHOD_REJECTED:"JSONRPC_REQUEST_METHOD_REJECTED",JSONRPC_REQUEST_METHOD_UNAUTHORIZED:"JSONRPC_REQUEST_METHOD_UNAUTHORIZED",JSONRPC_REQUEST_METHOD_UNSUPPORTED:"JSONRPC_REQUEST_METHOD_UNSUPPORTED",DISCONNECTED_ALL_CHAINS:"DISCONNECTED_ALL_CHAINS",DISCONNECTED_TARGET_CHAIN:"DISCONNECTED_TARGET_CHAIN",DISAPPROVED_CHAINS:"DISAPPROVED_CHAINS",DISAPPROVED_JSONRPC:"DISAPPROVED_JSONRPC",DISAPPROVED_NOTIFICATION:"DISAPPROVED_NOTIFICATION",UNSUPPORTED_CHAINS:"UNSUPPORTED_CHAINS",UNSUPPORTED_JSONRPC:"UNSUPPORTED_JSONRPC",UNSUPPORTED_NOTIFICATION:"UNSUPPORTED_NOTIFICATION",UNSUPPORTED_SIGNAL:"UNSUPPORTED_SIGNAL",USER_DISCONNECTED:"USER_DISCONNECTED",UNKNOWN:"UNKNOWN"}),h="Something went wrong",p="parameter",g="session",y="Ethereum",E={[f.GENERIC]:{type:f.GENERIC,code:0,stringify:e=>(null==e?void 0:e.message)||h,format:e=>({code:E[f.GENERIC].code,message:E[f.GENERIC].stringify(e)})},[f.MISSING_OR_INVALID]:{type:f.MISSING_OR_INVALID,code:1e3,stringify:e=>"Missing or invalid "+((null==e?void 0:e.name)||p),format:e=>({code:E[f.MISSING_OR_INVALID].code,message:E[f.MISSING_OR_INVALID].stringify(e)})},[f.MISSING_RESPONSE]:{type:f.MISSING_RESPONSE,code:1001,stringify:e=>`Response is required for approved ${(null==e?void 0:e.context)||g} proposals`,format:e=>({code:E[f.MISSING_RESPONSE].code,message:E[f.MISSING_RESPONSE].stringify(e)})},[f.MISSING_DECRYPT_PARAMS]:{type:f.MISSING_DECRYPT_PARAMS,code:1002,stringify:e=>"Decrypt params required for "+((null==e?void 0:e.context)||g),format:e=>({code:E[f.MISSING_DECRYPT_PARAMS].code,message:E[f.MISSING_DECRYPT_PARAMS].stringify(e)})},[f.INVALID_UPDATE_REQUEST]:{type:f.INVALID_UPDATE_REQUEST,code:1003,stringify:e=>`Invalid ${(null==e?void 0:e.context)||g} update request`,format:e=>({code:E[f.INVALID_UPDATE_REQUEST].code,message:E[f.INVALID_UPDATE_REQUEST].stringify(e)})},[f.INVALID_UPGRADE_REQUEST]:{type:f.INVALID_UPGRADE_REQUEST,code:1004,stringify:e=>`Invalid ${(null==e?void 0:e.context)||g} upgrade request`,format:e=>({code:E[f.INVALID_UPGRADE_REQUEST].code,message:E[f.INVALID_UPGRADE_REQUEST].stringify(e)})},[f.RECORD_ALREADY_EXISTS]:{type:f.RECORD_ALREADY_EXISTS,code:1100,stringify:e=>`Record already exists for ${(null==e?void 0:e.context)||g} matching id: ${null==e?void 0:e.id}`,format:e=>({code:E[f.RECORD_ALREADY_EXISTS].code,message:E[f.RECORD_ALREADY_EXISTS].stringify(e)})},[f.RESTORE_WILL_OVERRIDE]:{type:f.RESTORE_WILL_OVERRIDE,code:1200,stringify:e=>"Restore will override already set "+((null==e?void 0:e.context)||g),format:e=>({code:E[f.RESTORE_WILL_OVERRIDE].code,message:E[f.RESTORE_WILL_OVERRIDE].stringify(e)})},[f.NO_MATCHING_ID]:{type:f.NO_MATCHING_ID,code:1300,stringify:e=>`No matching ${(null==e?void 0:e.context)||g} with id: ${null==e?void 0:e.id}`,format:e=>({code:E[f.NO_MATCHING_ID].code,message:E[f.NO_MATCHING_ID].stringify(e)})},[f.NO_MATCHING_TOPIC]:{type:f.NO_MATCHING_TOPIC,code:1301,stringify:e=>`No matching ${(null==e?void 0:e.context)||g} with topic: ${null==e?void 0:e.topic}`,format:e=>({code:E[f.NO_MATCHING_TOPIC].code,message:E[f.NO_MATCHING_TOPIC].stringify(e)})},[f.NO_MATCHING_RESPONSE]:{type:f.NO_MATCHING_RESPONSE,code:1302,stringify:e=>`No response found in pending ${(null==e?void 0:e.context)||g} proposal`,format:e=>({code:E[f.NO_MATCHING_RESPONSE].code,message:E[f.NO_MATCHING_RESPONSE].stringify(e)})},[f.NO_MATCHING_KEY]:{type:f.NO_MATCHING_KEY,code:1303,stringify:e=>"No matching key with tag: "+(null==e?void 0:e.tag),format:e=>({code:E[f.NO_MATCHING_KEY].code,message:E[f.NO_MATCHING_KEY].stringify(e)})},[f.UNKNOWN_JSONRPC_METHOD]:{type:f.UNKNOWN_JSONRPC_METHOD,code:1400,stringify:e=>"Unknown JSON-RPC Method Requested: "+(null==e?void 0:e.method),format:e=>({code:E[f.UNKNOWN_JSONRPC_METHOD].code,message:E[f.UNKNOWN_JSONRPC_METHOD].stringify(e)})},[f.MISMATCHED_TOPIC]:{type:f.MISMATCHED_TOPIC,code:1500,stringify:e=>`Mismatched topic for ${(null==e?void 0:e.context)||g} with id: ${null==e?void 0:e.id}`,format:e=>({code:E[f.MISMATCHED_TOPIC].code,message:E[f.MISMATCHED_TOPIC].stringify(e)})},[f.MISMATCHED_ACCOUNTS]:{type:f.MISMATCHED_ACCOUNTS,code:1501,stringify:e=>"Invalid accounts with mismatched chains: "+(null==e?void 0:e.mismatched.toString()),format:e=>({code:E[f.MISMATCHED_ACCOUNTS].code,message:E[f.MISMATCHED_ACCOUNTS].stringify(e)})},[f.SETTLED]:{type:f.SETTLED,code:1600,stringify:e=>Object(l.c)((null==e?void 0:e.context)||g)+" settled",format:e=>({code:E[f.SETTLED].code,message:E[f.SETTLED].stringify(e)})},[f.NOT_APPROVED]:{type:f.NOT_APPROVED,code:1601,stringify:e=>Object(l.c)((null==e?void 0:e.context)||g)+" not approved",format:e=>({code:E[f.NOT_APPROVED].code,message:E[f.NOT_APPROVED].stringify(e)})},[f.PROPOSAL_RESPONDED]:{type:f.PROPOSAL_RESPONDED,code:1602,stringify:e=>Object(l.c)((null==e?void 0:e.context)||g)+" proposal responded",format:e=>({code:E[f.PROPOSAL_RESPONDED].code,message:E[f.PROPOSAL_RESPONDED].stringify(e)})},[f.RESPONSE_ACKNOWLEDGED]:{type:f.RESPONSE_ACKNOWLEDGED,code:1603,stringify:e=>Object(l.c)((null==e?void 0:e.context)||g)+" response acknowledge",format:e=>({code:E[f.RESPONSE_ACKNOWLEDGED].code,message:E[f.RESPONSE_ACKNOWLEDGED].stringify(e)})},[f.EXPIRED]:{type:f.EXPIRED,code:1603,stringify:e=>Object(l.c)((null==e?void 0:e.context)||g)+" expired",format:e=>({code:E[f.EXPIRED].code,message:E[f.EXPIRED].stringify(e)})},[f.SETTLE_TIMEOUT]:{type:f.SETTLE_TIMEOUT,code:2e3,stringify:e=>`${Object(l.c)((null==e?void 0:e.context)||g)} failed to settle after ${(null==e?void 0:e.timeout)/1e3} seconds`,format:e=>({code:E[f.SETTLE_TIMEOUT].code,message:E[f.SETTLE_TIMEOUT].stringify(e)})},[f.JSONRPC_REQUEST_TIMEOUT]:{type:f.JSONRPC_REQUEST_TIMEOUT,code:2001,stringify:e=>`JSON-RPC Request timeout after ${(null==e?void 0:e.timeout)/1e3} seconds: ${null==e?void 0:e.method}`,format:e=>({code:E[f.JSONRPC_REQUEST_TIMEOUT].code,message:E[f.JSONRPC_REQUEST_TIMEOUT].stringify(e)})},[f.UNAUTHORIZED_TARGET_CHAIN]:{type:f.UNAUTHORIZED_TARGET_CHAIN,code:3e3,stringify:e=>"Unauthorized Target ChainId Requested: "+(null==e?void 0:e.chainId),format:e=>({code:E[f.UNAUTHORIZED_TARGET_CHAIN].code,message:E[f.UNAUTHORIZED_TARGET_CHAIN].stringify(e)})},[f.UNAUTHORIZED_JSON_RPC_METHOD]:{type:f.UNAUTHORIZED_JSON_RPC_METHOD,code:3001,stringify:e=>"Unauthorized JSON-RPC Method Requested: "+(null==e?void 0:e.method),format:e=>({code:E[f.UNAUTHORIZED_JSON_RPC_METHOD].code,message:E[f.UNAUTHORIZED_JSON_RPC_METHOD].stringify(e)})},[f.UNAUTHORIZED_NOTIFICATION_TYPE]:{type:f.UNAUTHORIZED_NOTIFICATION_TYPE,code:3002,stringify:e=>"Unauthorized Notification Type Requested: "+(null==e?void 0:e.type),format:e=>({code:E[f.UNAUTHORIZED_NOTIFICATION_TYPE].code,message:E[f.UNAUTHORIZED_NOTIFICATION_TYPE].stringify(e)})},[f.UNAUTHORIZED_UPDATE_REQUEST]:{type:f.UNAUTHORIZED_UPDATE_REQUEST,code:3003,stringify:e=>`Unauthorized ${(null==e?void 0:e.context)||g} update request`,format:e=>({code:E[f.UNAUTHORIZED_UPDATE_REQUEST].code,message:E[f.UNAUTHORIZED_UPDATE_REQUEST].stringify(e)})},[f.UNAUTHORIZED_UPGRADE_REQUEST]:{type:f.UNAUTHORIZED_UPGRADE_REQUEST,code:3004,stringify:e=>`Unauthorized ${(null==e?void 0:e.context)||g} upgrade request`,format:e=>({code:E[f.UNAUTHORIZED_UPGRADE_REQUEST].code,message:E[f.UNAUTHORIZED_UPGRADE_REQUEST].stringify(e)})},[f.UNAUTHORIZED_MATCHING_CONTROLLER]:{type:f.UNAUTHORIZED_MATCHING_CONTROLLER,code:3005,stringify:e=>`Unauthorized: peer is also ${(null==e?void 0:e.controller)?"":"not "}controller`,format:e=>({code:E[f.UNAUTHORIZED_MATCHING_CONTROLLER].code,message:E[f.UNAUTHORIZED_MATCHING_CONTROLLER].stringify(e)})},[f.JSONRPC_REQUEST_METHOD_REJECTED]:{type:f.JSONRPC_REQUEST_METHOD_REJECTED,code:4001,stringify:e=>"User rejected the request.",format:e=>({code:E[f.JSONRPC_REQUEST_METHOD_REJECTED].code,message:E[f.JSONRPC_REQUEST_METHOD_REJECTED].stringify(e)})},[f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED]:{type:f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED,code:4100,stringify:e=>"The requested account and/or method has not been authorized by the user.",format:e=>({code:E[f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED].code,message:E[f.JSONRPC_REQUEST_METHOD_UNAUTHORIZED].stringify(e)})},[f.JSONRPC_REQUEST_METHOD_UNSUPPORTED]:{type:f.JSONRPC_REQUEST_METHOD_UNSUPPORTED,code:4200,stringify:e=>`The requested method is not supported by this ${(null==e?void 0:e.blockhain)||y} provider.`,format:e=>({code:E[f.JSONRPC_REQUEST_METHOD_UNSUPPORTED].code,message:E[f.JSONRPC_REQUEST_METHOD_UNSUPPORTED].stringify(e)})},[f.DISCONNECTED_ALL_CHAINS]:{type:f.DISCONNECTED_ALL_CHAINS,code:4900,stringify:e=>"The provider is disconnected from all chains.",format:e=>({code:E[f.DISCONNECTED_ALL_CHAINS].code,message:E[f.DISCONNECTED_ALL_CHAINS].stringify(e)})},[f.DISCONNECTED_TARGET_CHAIN]:{type:f.DISCONNECTED_TARGET_CHAIN,code:4901,stringify:e=>"The provider is disconnected from the specified chain.",format:e=>({code:E[f.DISCONNECTED_TARGET_CHAIN].code,message:E[f.DISCONNECTED_TARGET_CHAIN].stringify(e)})},[f.DISAPPROVED_CHAINS]:{type:f.DISAPPROVED_CHAINS,code:5e3,stringify:e=>"User disapproved requested chains",format:e=>({code:E[f.DISAPPROVED_CHAINS].code,message:E[f.DISAPPROVED_CHAINS].stringify(e)})},[f.DISAPPROVED_JSONRPC]:{type:f.DISAPPROVED_JSONRPC,code:5001,stringify:e=>"User disapproved requested json-rpc methods",format:e=>({code:E[f.DISAPPROVED_JSONRPC].code,message:E[f.DISAPPROVED_JSONRPC].stringify(e)})},[f.DISAPPROVED_NOTIFICATION]:{type:f.DISAPPROVED_NOTIFICATION,code:5002,stringify:e=>"User disapproved requested notification types",format:e=>({code:E[f.DISAPPROVED_NOTIFICATION].code,message:E[f.DISAPPROVED_NOTIFICATION].stringify(e)})},[f.UNSUPPORTED_CHAINS]:{type:f.UNSUPPORTED_CHAINS,code:5100,stringify:e=>"Requested chains are not supported: "+(null==e?void 0:e.chains.toString()),format:e=>({code:E[f.UNSUPPORTED_CHAINS].code,message:E[f.UNSUPPORTED_CHAINS].stringify(e)})},[f.UNSUPPORTED_JSONRPC]:{type:f.UNSUPPORTED_JSONRPC,code:5101,stringify:e=>"Requested json-rpc methods are not supported: "+(null==e?void 0:e.methods.toString()),format:e=>({code:E[f.UNSUPPORTED_JSONRPC].code,message:E[f.UNSUPPORTED_JSONRPC].stringify(e)})},[f.UNSUPPORTED_NOTIFICATION]:{type:f.UNSUPPORTED_NOTIFICATION,code:5102,stringify:e=>"Requested notification types are not supported: "+(null==e?void 0:e.types.toString()),format:e=>({code:E[f.UNSUPPORTED_NOTIFICATION].code,message:E[f.UNSUPPORTED_NOTIFICATION].stringify(e)})},[f.UNSUPPORTED_SIGNAL]:{type:f.UNSUPPORTED_SIGNAL,code:5103,stringify:e=>`Proposed ${(null==e?void 0:e.context)||g} signal is unsupported`,format:e=>({code:E[f.UNSUPPORTED_SIGNAL].code,message:E[f.UNSUPPORTED_SIGNAL].stringify(e)})},[f.USER_DISCONNECTED]:{type:f.USER_DISCONNECTED,code:5900,stringify:e=>"User disconnected "+((null==e?void 0:e.context)||g),format:e=>({code:E[f.USER_DISCONNECTED].code,message:E[f.USER_DISCONNECTED].stringify(e)})},[f.UNKNOWN]:{type:f.UNKNOWN,code:9e3,stringify:e=>"Unknown error"+(e?": "+(null==e?void 0:e.toString()):""),format:e=>({code:E[f.UNKNOWN].code,message:E[f.UNKNOWN].stringify(e)})}};var _=n(23),v=n(17);function m(e){return`${e.protocol}:${e.topic}@${e.version}?`+_.stringify({publicKey:e.publicKey,controller:e.controller,relay:Object(v.safeJsonStringify)(e.relay)})}function R(e){const t=e.indexOf(":"),n=-1!==e.indexOf("?")?e.indexOf("?"):void 0,r=e.substring(0,t),i=e.substring(t+1,n).split("@"),o=void 0!==n?e.substr(n):"",s=_.parse(o);return{protocol:r,topic:i[0],version:parseInt(i[1],10),publicKey:s.publicKey,controller:"true"===s.controller,relay:Object(v.safeJsonParse)(s.relay)}}function S(e){return"pairing"===e.method}function T(e){return"uri"===e.method}function O(e){return"responded"===e}function b(e){return O(e.status)&&"outcome"in e}function N(e){return"reason"in e}function I(e){return"responded"===e}function w(e){return I(e.status)&&"outcome"in e}function A(e){return"reason"in e}function P(e){return"responded"===e}function C(e){return I(e.status)&&"outcome"in e}function U(e){return"reason"in e}function D(e){return"update"in e}function L(e){const t=q(e.blockchain);if(F(t))return t;const n=H(e.jsonrpc);if(F(n))return n;const r=K(e.notifications);return F(r)?r:{valid:!0}}function M(e){return B(e.name)?B(e.description)?void 0!==e.url&&k(e.url)?void 0!==e.icons&&V(e.icons,k)?{valid:!0}:z(E.MISSING_OR_INVALID.format({name:"metadata icons"})):z(E.MISSING_OR_INVALID.format({name:"metadata url"})):z(E.MISSING_OR_INVALID.format({name:"metadata description"})):z(E.MISSING_OR_INVALID.format({name:"metadata name"}))}function x(e){const t=L(e.permissions);if(F(t))return t;const n=M(e.metadata);return F(n)?n:{valid:!0}}function j(e){if(e.approved){if(void 0===e.response)return z(E.MISSING_RESPONSE.format({context:"session"}));const t=G(e.response.state,e.proposal.permissions.blockchain);if(F(t))return t;const n=M(e.response.metadata);if(F(n))return n}return{valid:!0}}function q(e){return void 0!==e&&void 0!==e.chains&&V(e.chains,Y)?{valid:!0}:z(E.MISSING_OR_INVALID.format({name:"blockchain permissions"}))}function H(e){return void 0!==e&&void 0!==e.methods&&V(e.methods,B)?{valid:!0}:z(E.MISSING_OR_INVALID.format({name:"jsonrpc permissions"}))}function K(e){return void 0!==e&&void 0!==e.types&&V(e.types,B)?{valid:!0}:z(E.MISSING_OR_INVALID.format({name:"notification permissions"}))}function G(e,t){if(void 0===t||void 0===t.chains||!V(t.chains,Y))return z(E.MISSING_OR_INVALID.format({name:"blockchain permissions"}));if(void 0===e||void 0===e.accounts||!V(e.accounts,J))return z(E.MISSING_OR_INVALID.format({name:"state accounts"}));const n=e.accounts.filter(e=>{const n=e.split("@")[1];return!t.chains.includes(n)});return n.length?z(E.MISMATCHED_ACCOUNTS.format({mismatched:n})):{valid:!0}}function V(e,t){if(Array.isArray(e)){if(void 0!==t&&e.length){return e.filter(t).length===e.length}return!0}return!1}function B(e){return"string"==typeof e&&!!e.trim()}function Y(e){if(B(e)&&e.includes(":")){return 2===e.split(":").length}return!1}function J(e){if(B(e)&&e.includes("@")){const t=e.split("@");if(2===t.length)return!!t[0]&&Y(t[1])}return!1}function k(e){if(B(e))try{return void 0!==new URL(e)}catch(e){return!1}return!1}function F(e){return"valid"in e&&!1===e.valid&&"error"in e&&"number"==typeof e.error.code&&"string"==typeof e.error.message}function W(){return{valid:!0}}function z(e){return{valid:!1,error:e}}},function(e,t,n){"use strict";n.r(t);var r=n(33);n.d(t,"IClient",(function(){return r.a}));var i=n(37);n.d(t,"IPairing",(function(){return i.a}));var o=n(38);n.d(t,"IKeyChain",(function(){return o.b})),n.d(t,"ICrypto",(function(){return o.a}));var s=n(39);n.d(t,"IEngine",(function(){return s.a}));var a=n(40);n.d(t,"IJsonRpcHistory",(function(){return a.a}));var c=n(41);for(var u in c)["default","IClient","IPairing","IKeyChain","ICrypto","IEngine","IJsonRpcHistory"].indexOf(u)<0&&function(e){n.d(t,e,(function(){return c[e]}))}(u);var d=n(42);n.d(t,"IRelayer",(function(){return d.a}));var l=n(22);n.d(t,"ISequence",(function(){return l.a}));var f=n(43);n.d(t,"ISession",(function(){return f.a}));var h=n(44);n.d(t,"ISubscription",(function(){return h.a}))},function(e,t,n){"use strict";function r(e){if("string"!=typeof e)throw new Error("Cannot safe json parse value of type "+typeof e);try{return JSON.parse(e)}catch(t){return e}}function i(e){return"string"==typeof e?e:JSON.stringify(e)}n.r(t),n.d(t,"safeJsonParse",(function(){return r})),n.d(t,"safeJsonStringify",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"d",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"b",(function(){return c})),n.d(t,"g",(function(){return u})),n.d(t,"f",(function(){return d}));var r=n(3);function i(e){return e<=r.h[0]&&e>=r.h[1]}function o(e){return r.f.includes(e)}function s(e){return"number"==typeof e}function a(e){return Object.keys(r.i).includes(e)?r.i[e]:r.i[r.a]}function c(e){const t=Object.values(r.i).find(t=>t.code===e);return t||r.i[r.a]}function u(e){if(void 0===e.error.code)return{valid:!1,error:"Missing code for JSON-RPC error"};if(void 0===e.error.message)return{valid:!1,error:"Missing message for JSON-RPC error"};if(!s(e.error.code))return{valid:!1,error:"Invalid error code type for JSON-RPC: "+e.error.code};if(o(e.error.code)){const t=c(e.error.code);if(t.message!==r.i[r.a].message&&e.error.message===t.message)return{valid:!1,error:"Invalid error code message for JSON-RPC: "+e.error.code}}return{valid:!0}}function d(e,t,n){return e.message.includes("getaddrinfo ENOTFOUND")||e.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${n} RPC url at ${t}`):e}},function(e,t,n){"use strict";var r=n(2);n.o(r,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return r.decryptWithSharedKey})),n.o(r,"derive")&&n.d(t,"derive",(function(){return r.derive})),n.o(r,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return r.encryptWithSharedKey})),n.o(r,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return r.generateKeyPair})),n.o(r,"randomBytes")&&n.d(t,"randomBytes",(function(){return r.randomBytes})),n.o(r,"sha256")&&n.d(t,"sha256",(function(){return r.sha256}));var i=n(54);n.d(t,"decryptWithSharedKey",(function(){return i.a})),n.d(t,"encryptWithSharedKey",(function(){return i.b}));var o=n(10);n.d(t,"derive",(function(){return o.a})),n.d(t,"generateKeyPair",(function(){return o.c}))},function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n),Object.defineProperty(e,r,{enumerable:!0,get:function(){return t[n]}})}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),i=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||t.hasOwnProperty(n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),i(n(57),t),i(n(97),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FIVE_SECONDS=t.TEN_SECONDS=t.THIRTY_SECONDS=t.FIVE_MINUTES=t.SIX_HOURS=t.ONE_DAY=t.SEVEN_DAYS=t.THREE_WEEKS=t.THIRTY_DAYS=void 0,t.THIRTY_DAYS=2592e3,t.THREE_WEEKS=1814400,t.SEVEN_DAYS=604800,t.ONE_DAY=86400,t.SIX_HOURS=21600,t.FIVE_MINUTES=300,t.THIRTY_SECONDS=30,t.TEN_SECONDS=10,t.FIVE_SECONDS=5},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(7);class i extends r.IEvents{constructor(e,t){super(),this.client=e,this.logger=t}}},function(e,t,n){"use strict";const r=n(93),i=n(94),o=n(95),s=n(96);function a(e){if("string"!=typeof e||1!==e.length)throw new TypeError("arrayFormatSeparator must be single character string")}function c(e,t){return t.encode?t.strict?r(e):encodeURIComponent(e):e}function u(e,t){return t.decode?i(e):e}function d(e){const t=e.indexOf("#");return-1!==t&&(e=e.slice(0,t)),e}function l(e){const t=(e=d(e)).indexOf("?");return-1===t?"":e.slice(t+1)}function f(e,t){return t.parseNumbers&&!Number.isNaN(Number(e))&&"string"==typeof e&&""!==e.trim()?e=Number(e):!t.parseBooleans||null===e||"true"!==e.toLowerCase()&&"false"!==e.toLowerCase()||(e="true"===e.toLowerCase()),e}function h(e,t){a((t=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},t)).arrayFormatSeparator);const n=function(e){let t;switch(e.arrayFormat){case"index":return(e,n,r)=>{t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===r[e]&&(r[e]={}),r[e][t[1]]=n):r[e]=n};case"bracket":return(e,n,r)=>{t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0!==r[e]?r[e]=[].concat(r[e],n):r[e]=[n]:r[e]=n};case"comma":case"separator":return(t,n,r)=>{const i="string"==typeof n&&n.includes(e.arrayFormatSeparator),o="string"==typeof n&&!i&&u(n,e).includes(e.arrayFormatSeparator);n=o?u(n,e):n;const s=i||o?n.split(e.arrayFormatSeparator).map(t=>u(t,e)):null===n?n:u(n,e);r[t]=s};default:return(e,t,n)=>{void 0!==n[e]?n[e]=[].concat(n[e],t):n[e]=t}}}(t),r=Object.create(null);if("string"!=typeof e)return r;if(!(e=e.trim().replace(/^[?#&]/,"")))return r;for(const i of e.split("&")){if(""===i)continue;let[e,s]=o(t.decode?i.replace(/\+/g," "):i,"=");s=void 0===s?null:["comma","separator"].includes(t.arrayFormat)?s:u(s,t),n(u(e,t),s,r)}for(const e of Object.keys(r)){const n=r[e];if("object"==typeof n&&null!==n)for(const e of Object.keys(n))n[e]=f(n[e],t);else r[e]=f(n,t)}return!1===t.sort?r:(!0===t.sort?Object.keys(r).sort():Object.keys(r).sort(t.sort)).reduce((e,t)=>{const n=r[t];return Boolean(n)&&"object"==typeof n&&!Array.isArray(n)?e[t]=function e(t){return Array.isArray(t)?t.sort():"object"==typeof t?e(Object.keys(t)).sort((e,t)=>Number(e)-Number(t)).map(e=>t[e]):t}(n):e[t]=n,e},Object.create(null))}t.extract=l,t.parse=h,t.stringify=(e,t)=>{if(!e)return"";a((t=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},t)).arrayFormatSeparator);const n=n=>t.skipNull&&null==e[n]||t.skipEmptyString&&""===e[n],r=function(e){switch(e.arrayFormat){case"index":return t=>(n,r)=>{const i=n.length;return void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[c(t,e),"[",i,"]"].join("")]:[...n,[c(t,e),"[",c(i,e),"]=",c(r,e)].join("")]};case"bracket":return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,[c(t,e),"[]"].join("")]:[...n,[c(t,e),"[]=",c(r,e)].join("")];case"comma":case"separator":return t=>(n,r)=>null==r||0===r.length?n:0===n.length?[[c(t,e),"=",c(r,e)].join("")]:[[n,c(r,e)].join(e.arrayFormatSeparator)];default:return t=>(n,r)=>void 0===r||e.skipNull&&null===r||e.skipEmptyString&&""===r?n:null===r?[...n,c(t,e)]:[...n,[c(t,e),"=",c(r,e)].join("")]}}(t),i={};for(const t of Object.keys(e))n(t)||(i[t]=e[t]);const o=Object.keys(i);return!1!==t.sort&&o.sort(t.sort),o.map(n=>{const i=e[n];return void 0===i?"":null===i?c(n,t):Array.isArray(i)?i.reduce(r(n),[]).join("&"):c(n,t)+"="+c(i,t)}).filter(e=>e.length>0).join("&")},t.parseUrl=(e,t)=>{t=Object.assign({decode:!0},t);const[n,r]=o(e,"#");return Object.assign({url:n.split("?")[0]||"",query:h(l(e),t)},t&&t.parseFragmentIdentifier&&r?{fragmentIdentifier:u(r,t)}:{})},t.stringifyUrl=(e,n)=>{n=Object.assign({encode:!0,strict:!0},n);const r=d(e.url).split("?")[0]||"",i=t.extract(e.url),o=t.parse(i,{sort:!1}),s=Object.assign(o,e.query);let a=t.stringify(s,n);a&&(a="?"+a);let u=function(e){let t="";const n=e.indexOf("#");return-1!==n&&(t=e.slice(n)),t}(e.url);return e.fragmentIdentifier&&(u="#"+c(e.fragmentIdentifier,n)),`${r}${a}${u}`},t.pick=(e,n,r)=>{r=Object.assign({parseFragmentIdentifier:!0},r);const{url:i,query:o,fragmentIdentifier:a}=t.parseUrl(e,r);return t.stringifyUrl({url:i,query:s(o,n),fragmentIdentifier:a},r)},t.exclude=(e,n,r)=>{const i=Array.isArray(n)?e=>!n.includes(e):(e,t)=>!n(e,t);return t.pick(e,i,r)}},function(e,t,n){"use strict";function r(e){let t=void 0;return"undefined"!=typeof window&&void 0!==window[e]&&(t=window[e]),t}function i(e){const t=r(e);if(!t)throw new Error(e+" is not defined in Window");return t}Object.defineProperty(t,"__esModule",{value:!0}),t.getLocalStorage=t.getLocalStorageOrThrow=t.getCrypto=t.getCryptoOrThrow=t.getLocation=t.getLocationOrThrow=t.getNavigator=t.getNavigatorOrThrow=t.getDocument=t.getDocumentOrThrow=t.getFromWindowOrThrow=t.getFromWindow=void 0,t.getFromWindow=r,t.getFromWindowOrThrow=i,t.getDocumentOrThrow=function(){return i("document")},t.getDocument=function(){return r("document")},t.getNavigatorOrThrow=function(){return i("navigator")},t.getNavigator=function(){return r("navigator")},t.getLocationOrThrow=function(){return i("location")},t.getLocation=function(){return r("location")},t.getCryptoOrThrow=function(){return i("crypto")},t.getCrypto=function(){return r("crypto")},t.getLocalStorageOrThrow=function(){return i("localStorage")},t.getLocalStorage=function(){return r("localStorage")}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{}},function(e,t,n){"use strict";var r=n(49);n.o(r,"ERROR_BAD_MAC")&&n.d(t,"ERROR_BAD_MAC",(function(){return r.ERROR_BAD_MAC})),n.o(r,"IV_LENGTH")&&n.d(t,"IV_LENGTH",(function(){return r.IV_LENGTH})),n.o(r,"KEY_LENGTH")&&n.d(t,"KEY_LENGTH",(function(){return r.KEY_LENGTH})),n.o(r,"LENGTH_0")&&n.d(t,"LENGTH_0",(function(){return r.LENGTH_0})),n.o(r,"MAC_LENGTH")&&n.d(t,"MAC_LENGTH",(function(){return r.MAC_LENGTH})),n.o(r,"assert")&&n.d(t,"assert",(function(){return r.assert})),n.o(r,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return r.decryptWithSharedKey})),n.o(r,"derive")&&n.d(t,"derive",(function(){return r.derive})),n.o(r,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return r.encryptWithSharedKey})),n.o(r,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return r.generateKeyPair})),n.o(r,"isConstantTime")&&n.d(t,"isConstantTime",(function(){return r.isConstantTime}));n(50);var i=n(51);n.o(i,"ERROR_BAD_MAC")&&n.d(t,"ERROR_BAD_MAC",(function(){return i.ERROR_BAD_MAC})),n.o(i,"IV_LENGTH")&&n.d(t,"IV_LENGTH",(function(){return i.IV_LENGTH})),n.o(i,"KEY_LENGTH")&&n.d(t,"KEY_LENGTH",(function(){return i.KEY_LENGTH})),n.o(i,"LENGTH_0")&&n.d(t,"LENGTH_0",(function(){return i.LENGTH_0})),n.o(i,"MAC_LENGTH")&&n.d(t,"MAC_LENGTH",(function(){return i.MAC_LENGTH})),n.o(i,"assert")&&n.d(t,"assert",(function(){return i.assert})),n.o(i,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return i.decryptWithSharedKey})),n.o(i,"derive")&&n.d(t,"derive",(function(){return i.derive})),n.o(i,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return i.encryptWithSharedKey})),n.o(i,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return i.generateKeyPair})),n.o(i,"isConstantTime")&&n.d(t,"isConstantTime",(function(){return i.isConstantTime}));var o=n(52);n.d(t,"assert",(function(){return o.a})),n.d(t,"isConstantTime",(function(){return o.b}))},function(e,t){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(e){"object"==typeof window&&(n=window)}e.exports=n},function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return a}));var r=n(12),i=n(17),o=n(6);const s=void 0!==e.WebSocket?e.WebSocket:n(110);class a{constructor(e){if(this.url=e,this.events=new r.EventEmitter,this.registering=!1,!Object(o.isWsUrl)(e))throw new Error("Provided URL is not compatible with WebSocket connection: "+e);this.url=e}get connected(){return void 0!==this.socket}get connecting(){return this.registering}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async open(e=this.url){await this.register(e)}async close(){if(void 0===this.socket)throw new Error("Connection already closed");this.socket.close(),this.onClose()}async send(e,t){void 0===this.socket&&(this.socket=await this.register());try{this.socket.send(Object(i.safeJsonStringify)(e))}catch(t){this.onError(e.id,t)}}register(e=this.url){if(!Object(o.isWsUrl)(e))throw new Error("Provided URL is not compatible with WebSocket connection: "+e);return this.registering?new Promise((e,t)=>{this.events.once("register_error",e=>{t(e)}),this.events.once("open",()=>{if(void 0===this.socket)return t(new Error("WebSocket connection is missing or invalid"));e(this.socket)})}):(this.url=e,this.registering=!0,new Promise((t,n)=>{const r=Object(o.isReactNative)()?void 0:{rejectUnauthorized:!Object(o.isLocalhostUrl)(e)},i=new s(e,[],r);i.onopen=()=>{this.onOpen(i),t(i)},i.onerror=e=>{const t=this.parseError(e.error);this.events.emit("register_error",t),this.onClose(),n(t)}}))}onOpen(e){e.onmessage=e=>this.onPayload(e),e.onclose=()=>this.onClose(),e.onerror=e=>{const t=this.parseError(e.error);this.events.emit("error",t)},this.socket=e,this.registering=!1,this.events.emit("open")}onClose(){this.socket=void 0,this.registering=!1,this.events.emit("close")}onPayload(e){if(void 0===e.data)return;const t="string"==typeof e.data?Object(i.safeJsonParse)(e.data):e.data;this.events.emit("payload",t)}onError(e,t){const n=this.parseError(t),r=n.message||n.toString(),i=Object(o.formatJsonRpcError)(e,r);this.events.emit("payload",i)}parseError(e,t=this.url){return Object(o.parseConnectionError)(e,t,"WS")}}t.b=a}).call(this,n(27))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.wipe=function(e){for(var t=0;t<e.length;t++)e[t]=0;return e}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Subscription=void 0;const r=n(8),i=n(12),o=n(16),s=n(15),a=n(14),c=n(20);class u extends o.ISubscription{constructor(e,t,n){super(e,t,n),this.client=e,this.logger=t,this.context=n,this.subscriptions=new Map,this.events=new i.EventEmitter,this.timeout=new Map,this.cached=[],this.logger=c.generateChildLogger(t,this.context),this.registerEventListeners()}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.restore()}))}get length(){return this.subscriptions.size}get topics(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}set(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.subscriptions.has(e)?this.update(e,t):(this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"set",topic:e,data:t,opts:n}),yield this.subscribeAndSet(e,t,n),this.events.emit(a.SUBSCRIPTION_EVENTS.created,{topic:e,data:t}))}))}get(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"get",topic:e});return(yield this.getSubscription(e)).data}))}update(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.logger.debug("Updating subscription"),this.logger.trace({type:"method",method:"update",topic:e,update:t});const n=yield this.getSubscription(e),r=Object.assign(Object.assign({},n.data),t);this.subscriptions.set(e,Object.assign(Object.assign({},n),{topic:e,data:r})),this.events.emit(a.SUBSCRIPTION_EVENTS.updated,{topic:e,data:r,update:t})}))}delete(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"delete",topic:e,reason:t});const n=yield this.getSubscription(e);this.subscriptions.delete(e),yield this.client.relayer.unsubscribe(n.topic,n.id,{relay:n.relay}),this.events.emit(a.SUBSCRIPTION_EVENTS.deleted,{topic:e,data:n.data,reason:t})}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}onPayload(e){return r.__awaiter(this,void 0,void 0,(function*(){this.events.emit(a.SUBSCRIPTION_EVENTS.payload,e)}))}getNestedContext(e){const t=c.getLoggerContext(this.logger).split("/");return t.slice(t.length-e,t.length)}getSubscriptionContext(){return this.getNestedContext(2).join(" ")}getStorageKey(){return`${`${this.client.protocol}@${this.client.version}:${this.client.context}`}//${this.getNestedContext(2).join(":")}`}getSubscription(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled();const t=this.subscriptions.get(e);if(!t){const t=s.ERROR.NO_MATCHING_TOPIC.format({context:this.getSubscriptionContext(),topic:e});throw this.logger.error(t.message),new Error(t.message)}return t}))}subscribeAndSet(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.client.relayer.subscribe(e,t=>this.onPayload({topic:e,payload:t}),n),i=n.expiry||Date.now()+1e3*a.SUBSCRIPTION_DEFAULT_TTL;this.subscriptions.set(e,Object.assign(Object.assign({id:r,topic:e,data:t},n),{expiry:i})),this.setTimeout(e,i)}))}setTimeout(e,t){if(this.timeout.has(e))return;const n=t-Date.now();if(n<=0)return void this.onTimeout(e);if(n>a.CLIENT_BEAT_INTERVAL)return;const r=setTimeout(()=>this.onTimeout(e),n);this.timeout.set(e,r)}deleteTimeout(e){if(!this.timeout.has(e))return;const t=this.timeout.get(e);void 0!==t&&clearTimeout(t)}resetTimeout(){this.timeout.forEach(e=>clearTimeout(e)),this.timeout.clear()}onTimeout(e){this.deleteTimeout(e),this.delete(e,s.ERROR.EXPIRED.format({context:this.getSubscriptionContext()}))}checkSubscriptions(){this.subscriptions.forEach(e=>this.setTimeout(e.topic,e.expiry))}persist(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.client.storage.setItem(this.getStorageKey(),this.values),this.events.emit(a.SUBSCRIPTION_EVENTS.sync)}))}restore(){return r.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.client.storage.getItem(this.getStorageKey());if(void 0===e)return;if(!e.length)return;if(this.subscriptions.size){const e=s.ERROR.RESTORE_WILL_OVERRIDE.format({context:this.getSubscriptionContext()});throw this.logger.error(e.message),new Error(e.message)}this.cached=e,yield Promise.all(this.cached.map(e=>r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,data:n}=e,r={relay:e.relay,expiry:e.expiry};yield this.subscribeAndSet(t,n,r)})))),yield this.enable(),this.logger.debug("Successfully Restored subscriptions for "+this.getSubscriptionContext()),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug("Failed to Restore subscriptions for "+this.getSubscriptionContext()),this.logger.error(e)}}))}reset(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.disable(),yield Promise.all(this.cached.map(e=>r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,data:n}=e,r={relay:e.relay,expiry:e.expiry};yield this.subscribeAndSet(t,n,r)})))),yield this.enable()}))}isEnabled(){return r.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(a.SUBSCRIPTION_EVENTS.enabled,()=>e())})}))}enable(){return r.__awaiter(this,void 0,void 0,(function*(){this.cached=[],this.events.emit(a.SUBSCRIPTION_EVENTS.enabled)}))}disable(){return r.__awaiter(this,void 0,void 0,(function*(){this.cached.length||(this.cached=this.values),this.resetTimeout(),this.events.emit(a.SUBSCRIPTION_EVENTS.disabled)}))}registerEventListeners(){this.client.on(a.CLIENT_EVENTS.beat,()=>this.checkSubscriptions()),this.client.relayer.on(a.RELAYER_EVENTS.connect,()=>this.reset()),this.events.on(a.SUBSCRIPTION_EVENTS.payload,e=>{const t=a.SUBSCRIPTION_EVENTS.payload;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e})}),this.events.on(a.SUBSCRIPTION_EVENTS.created,e=>{const t=a.SUBSCRIPTION_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(a.SUBSCRIPTION_EVENTS.updated,e=>{const t=a.SUBSCRIPTION_EVENTS.updated;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()}),this.events.on(a.SUBSCRIPTION_EVENTS.deleted,e=>{const t=a.SUBSCRIPTION_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.persist()})}}t.Subscription=u},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(86),i=n(29);function o(e){var t=new Float64Array(16);if(e)for(var n=0;n<e.length;n++)t[n]=e[n];return t}t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;var s=new Uint8Array(32);s[0]=9;var a=o([56129,1]);function c(e){for(var t=1,n=0;n<16;n++){var r=e[n]+t+65535;t=Math.floor(r/65536),e[n]=r-65536*t}e[0]+=t-1+37*(t-1)}function u(e,t,n){for(var r=~(n-1),i=0;i<16;i++){var o=r&(e[i]^t[i]);e[i]^=o,t[i]^=o}}function d(e,t,n){for(var r=0;r<16;r++)e[r]=t[r]+n[r]}function l(e,t,n){for(var r=0;r<16;r++)e[r]=t[r]-n[r]}function f(e,t,n){var r,i,o=0,s=0,a=0,c=0,u=0,d=0,l=0,f=0,h=0,p=0,g=0,y=0,E=0,_=0,v=0,m=0,R=0,S=0,T=0,O=0,b=0,N=0,I=0,w=0,A=0,P=0,C=0,U=0,D=0,L=0,M=0,x=n[0],j=n[1],q=n[2],H=n[3],K=n[4],G=n[5],V=n[6],B=n[7],Y=n[8],J=n[9],k=n[10],F=n[11],W=n[12],z=n[13],Q=n[14],$=n[15];o+=(r=t[0])*x,s+=r*j,a+=r*q,c+=r*H,u+=r*K,d+=r*G,l+=r*V,f+=r*B,h+=r*Y,p+=r*J,g+=r*k,y+=r*F,E+=r*W,_+=r*z,v+=r*Q,m+=r*$,s+=(r=t[1])*x,a+=r*j,c+=r*q,u+=r*H,d+=r*K,l+=r*G,f+=r*V,h+=r*B,p+=r*Y,g+=r*J,y+=r*k,E+=r*F,_+=r*W,v+=r*z,m+=r*Q,R+=r*$,a+=(r=t[2])*x,c+=r*j,u+=r*q,d+=r*H,l+=r*K,f+=r*G,h+=r*V,p+=r*B,g+=r*Y,y+=r*J,E+=r*k,_+=r*F,v+=r*W,m+=r*z,R+=r*Q,S+=r*$,c+=(r=t[3])*x,u+=r*j,d+=r*q,l+=r*H,f+=r*K,h+=r*G,p+=r*V,g+=r*B,y+=r*Y,E+=r*J,_+=r*k,v+=r*F,m+=r*W,R+=r*z,S+=r*Q,T+=r*$,u+=(r=t[4])*x,d+=r*j,l+=r*q,f+=r*H,h+=r*K,p+=r*G,g+=r*V,y+=r*B,E+=r*Y,_+=r*J,v+=r*k,m+=r*F,R+=r*W,S+=r*z,T+=r*Q,O+=r*$,d+=(r=t[5])*x,l+=r*j,f+=r*q,h+=r*H,p+=r*K,g+=r*G,y+=r*V,E+=r*B,_+=r*Y,v+=r*J,m+=r*k,R+=r*F,S+=r*W,T+=r*z,O+=r*Q,b+=r*$,l+=(r=t[6])*x,f+=r*j,h+=r*q,p+=r*H,g+=r*K,y+=r*G,E+=r*V,_+=r*B,v+=r*Y,m+=r*J,R+=r*k,S+=r*F,T+=r*W,O+=r*z,b+=r*Q,N+=r*$,f+=(r=t[7])*x,h+=r*j,p+=r*q,g+=r*H,y+=r*K,E+=r*G,_+=r*V,v+=r*B,m+=r*Y,R+=r*J,S+=r*k,T+=r*F,O+=r*W,b+=r*z,N+=r*Q,I+=r*$,h+=(r=t[8])*x,p+=r*j,g+=r*q,y+=r*H,E+=r*K,_+=r*G,v+=r*V,m+=r*B,R+=r*Y,S+=r*J,T+=r*k,O+=r*F,b+=r*W,N+=r*z,I+=r*Q,w+=r*$,p+=(r=t[9])*x,g+=r*j,y+=r*q,E+=r*H,_+=r*K,v+=r*G,m+=r*V,R+=r*B,S+=r*Y,T+=r*J,O+=r*k,b+=r*F,N+=r*W,I+=r*z,w+=r*Q,A+=r*$,g+=(r=t[10])*x,y+=r*j,E+=r*q,_+=r*H,v+=r*K,m+=r*G,R+=r*V,S+=r*B,T+=r*Y,O+=r*J,b+=r*k,N+=r*F,I+=r*W,w+=r*z,A+=r*Q,P+=r*$,y+=(r=t[11])*x,E+=r*j,_+=r*q,v+=r*H,m+=r*K,R+=r*G,S+=r*V,T+=r*B,O+=r*Y,b+=r*J,N+=r*k,I+=r*F,w+=r*W,A+=r*z,P+=r*Q,C+=r*$,E+=(r=t[12])*x,_+=r*j,v+=r*q,m+=r*H,R+=r*K,S+=r*G,T+=r*V,O+=r*B,b+=r*Y,N+=r*J,I+=r*k,w+=r*F,A+=r*W,P+=r*z,C+=r*Q,U+=r*$,_+=(r=t[13])*x,v+=r*j,m+=r*q,R+=r*H,S+=r*K,T+=r*G,O+=r*V,b+=r*B,N+=r*Y,I+=r*J,w+=r*k,A+=r*F,P+=r*W,C+=r*z,U+=r*Q,D+=r*$,v+=(r=t[14])*x,m+=r*j,R+=r*q,S+=r*H,T+=r*K,O+=r*G,b+=r*V,N+=r*B,I+=r*Y,w+=r*J,A+=r*k,P+=r*F,C+=r*W,U+=r*z,D+=r*Q,L+=r*$,m+=(r=t[15])*x,s+=38*(S+=r*q),a+=38*(T+=r*H),c+=38*(O+=r*K),u+=38*(b+=r*G),d+=38*(N+=r*V),l+=38*(I+=r*B),f+=38*(w+=r*Y),h+=38*(A+=r*J),p+=38*(P+=r*k),g+=38*(C+=r*F),y+=38*(U+=r*W),E+=38*(D+=r*z),_+=38*(L+=r*Q),v+=38*(M+=r*$),o=(r=(o+=38*(R+=r*j))+(i=1)+65535)-65536*(i=Math.floor(r/65536)),s=(r=s+i+65535)-65536*(i=Math.floor(r/65536)),a=(r=a+i+65535)-65536*(i=Math.floor(r/65536)),c=(r=c+i+65535)-65536*(i=Math.floor(r/65536)),u=(r=u+i+65535)-65536*(i=Math.floor(r/65536)),d=(r=d+i+65535)-65536*(i=Math.floor(r/65536)),l=(r=l+i+65535)-65536*(i=Math.floor(r/65536)),f=(r=f+i+65535)-65536*(i=Math.floor(r/65536)),h=(r=h+i+65535)-65536*(i=Math.floor(r/65536)),p=(r=p+i+65535)-65536*(i=Math.floor(r/65536)),g=(r=g+i+65535)-65536*(i=Math.floor(r/65536)),y=(r=y+i+65535)-65536*(i=Math.floor(r/65536)),E=(r=E+i+65535)-65536*(i=Math.floor(r/65536)),_=(r=_+i+65535)-65536*(i=Math.floor(r/65536)),v=(r=v+i+65535)-65536*(i=Math.floor(r/65536)),m=(r=m+i+65535)-65536*(i=Math.floor(r/65536)),o=(r=(o+=i-1+37*(i-1))+(i=1)+65535)-65536*(i=Math.floor(r/65536)),s=(r=s+i+65535)-65536*(i=Math.floor(r/65536)),a=(r=a+i+65535)-65536*(i=Math.floor(r/65536)),c=(r=c+i+65535)-65536*(i=Math.floor(r/65536)),u=(r=u+i+65535)-65536*(i=Math.floor(r/65536)),d=(r=d+i+65535)-65536*(i=Math.floor(r/65536)),l=(r=l+i+65535)-65536*(i=Math.floor(r/65536)),f=(r=f+i+65535)-65536*(i=Math.floor(r/65536)),h=(r=h+i+65535)-65536*(i=Math.floor(r/65536)),p=(r=p+i+65535)-65536*(i=Math.floor(r/65536)),g=(r=g+i+65535)-65536*(i=Math.floor(r/65536)),y=(r=y+i+65535)-65536*(i=Math.floor(r/65536)),E=(r=E+i+65535)-65536*(i=Math.floor(r/65536)),_=(r=_+i+65535)-65536*(i=Math.floor(r/65536)),v=(r=v+i+65535)-65536*(i=Math.floor(r/65536)),m=(r=m+i+65535)-65536*(i=Math.floor(r/65536)),o+=i-1+37*(i-1),e[0]=o,e[1]=s,e[2]=a,e[3]=c,e[4]=u,e[5]=d,e[6]=l,e[7]=f,e[8]=h,e[9]=p,e[10]=g,e[11]=y,e[12]=E,e[13]=_,e[14]=v,e[15]=m}function h(e,t){f(e,t,t)}function p(e,t){for(var n=new Uint8Array(32),r=new Float64Array(80),i=o(),s=o(),p=o(),g=o(),y=o(),E=o(),_=0;_<31;_++)n[_]=e[_];n[31]=127&e[31]|64,n[0]&=248,function(e,t){for(var n=0;n<16;n++)e[n]=t[2*n]+(t[2*n+1]<<8);e[15]&=32767}(r,t);for(_=0;_<16;_++)s[_]=r[_];i[0]=g[0]=1;for(_=254;_>=0;--_){var v=n[_>>>3]>>>(7&_)&1;u(i,s,v),u(p,g,v),d(y,i,p),l(i,i,p),d(p,s,g),l(s,s,g),h(g,y),h(E,i),f(i,p,i),f(p,s,y),d(y,i,p),l(i,i,p),h(s,i),l(p,g,E),f(i,p,a),d(i,i,g),f(p,p,i),f(i,g,E),f(g,s,r),h(s,y),u(i,s,v),u(p,g,v)}for(_=0;_<16;_++)r[_+16]=i[_],r[_+32]=p[_],r[_+48]=s[_],r[_+64]=g[_];var m=r.subarray(32),R=r.subarray(16);!function(e,t){for(var n=o(),r=0;r<16;r++)n[r]=t[r];for(r=253;r>=0;r--)h(n,n),2!==r&&4!==r&&f(n,n,t);for(r=0;r<16;r++)e[r]=n[r]}(m,m),f(R,R,m);var S=new Uint8Array(32);return function(e,t){for(var n=o(),r=o(),i=0;i<16;i++)r[i]=t[i];c(r),c(r),c(r);for(var s=0;s<2;s++){n[0]=r[0]-65517;for(i=1;i<15;i++)n[i]=r[i]-65535-(n[i-1]>>16&1),n[i-1]&=65535;n[15]=r[15]-32767-(n[14]>>16&1);var a=n[15]>>16&1;n[14]&=65535,u(r,n,1-a)}for(i=0;i<16;i++)e[2*i]=255&r[i],e[2*i+1]=r[i]>>8}(S,R),S}function g(e){return p(e,s)}function y(e){if(e.length!==t.SECRET_KEY_LENGTH)throw new Error("x25519: seed must be "+t.SECRET_KEY_LENGTH+" bytes");var n=new Uint8Array(e);return{publicKey:g(n),secretKey:n}}t.scalarMult=p,t.scalarMultBase=g,t.generateKeyPairFromSeed=y,t.generateKeyPair=function(e){var t=r.randomBytes(32,e),n=y(t);return i.wipe(t),n},t.sharedKey=function(e,n,r){if(void 0===r&&(r=!1),e.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(n.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");var i=p(e,n);if(r){for(var o=0,s=0;s<i.length;s++)o|=i[s];if(0===o)throw new Error("X25519: invalid shared key")}return i}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.safeJsonParse=function(e){if("string"!=typeof e)throw new Error("Cannot safe json parse value of type "+typeof e);try{return JSON.parse(e)}catch(t){return e}},t.safeJsonStringify=function(e){return"string"==typeof e?e:JSON.stringify(e,(e,t)=>void 0===t?null:t)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(7);class i extends r.IEvents{constructor(e){super(),this.protocol="wc",this.version=2}}},function(e,t){},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return s}));var r=n(25);class i extends r.a{constructor(e){super()}}class o extends r.a{constructor(){super()}}class s extends o{constructor(e){super()}}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(22);class i extends r.a{}},function(e,t,n){"use strict";n.d(t,"b",(function(){return r})),n.d(t,"a",(function(){return i}));class r{}class i{constructor(e,t){this.client=e,this.keychain=t}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));class r{constructor(e){this.sequence=e}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(7);class i extends r.IEvents{constructor(e,t){super(),this.client=e,this.logger=t,this.records=new Map}}},function(e,t){},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(7);class i extends r.IEvents{constructor(e,t,n){super(),this.client=e,this.logger=t}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(22);class i extends r.a{}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(7);class i extends r.IEvents{constructor(e,t,n){super(),this.client=e,this.logger=t,this.context=n,this.subscriptions=new Map}}},function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var r=n(4);function i(e){return r.getBrowerCrypto().getRandomValues(new Uint8Array(e))}},function(e,t){var n,r,i=e.exports={};function o(){throw new Error("setTimeout has not been defined")}function s(){throw new Error("clearTimeout has not been defined")}function a(e){if(n===setTimeout)return setTimeout(e,0);if((n===o||!n)&&setTimeout)return n=setTimeout,setTimeout(e,0);try{return n(e,0)}catch(t){try{return n.call(null,e,0)}catch(t){return n.call(this,e,0)}}}!function(){try{n="function"==typeof setTimeout?setTimeout:o}catch(e){n=o}try{r="function"==typeof clearTimeout?clearTimeout:s}catch(e){r=s}}();var c,u=[],d=!1,l=-1;function f(){d&&c&&(d=!1,c.length?u=c.concat(u):l=-1,u.length&&h())}function h(){if(!d){var e=a(f);d=!0;for(var t=u.length;t;){for(c=u,u=[];++l<t;)c&&c[l].run();l=-1,t=u.length}c=null,d=!1,function(e){if(r===clearTimeout)return clearTimeout(e);if((r===s||!r)&&clearTimeout)return r=clearTimeout,clearTimeout(e);try{r(e)}catch(t){try{return r.call(null,e)}catch(t){return r.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function g(){}i.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];u.push(new p(e,t)),1!==u.length||d||a(h)},p.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=g,i.addListener=g,i.once=g,i.off=g,i.removeListener=g,i.removeAllListeners=g,i.emit=g,i.prependListener=g,i.prependOnceListener=g,i.listeners=function(e){return[]},i.binding=function(e){throw new Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw new Error("process.chdir is not supported")},i.umask=function(){return 0}},function(e,t,n){"use strict";n.d(t,"b",(function(){return i})),n.d(t,"a",(function(){return o}));var r=n(9);function i(e,t,n){return Object(r.b)(e,t,n)}function o(e,t,n){return Object(r.a)(e,t,n)}},function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"b",(function(){return s}));var r=n(9),i=n(26);async function o(e,t){return await Object(r.c)(e,t)}async function s(e,t,n){const o=await Object(r.c)(e,t);return Object(i.isConstantTime)(o,n)}},function(e,t,n){"use strict";var r=n(4);n.o(r,"ERROR_BAD_MAC")&&n.d(t,"ERROR_BAD_MAC",(function(){return r.ERROR_BAD_MAC})),n.o(r,"IV_LENGTH")&&n.d(t,"IV_LENGTH",(function(){return r.IV_LENGTH})),n.o(r,"KEY_LENGTH")&&n.d(t,"KEY_LENGTH",(function(){return r.KEY_LENGTH})),n.o(r,"LENGTH_0")&&n.d(t,"LENGTH_0",(function(){return r.LENGTH_0})),n.o(r,"MAC_LENGTH")&&n.d(t,"MAC_LENGTH",(function(){return r.MAC_LENGTH})),n.o(r,"assert")&&n.d(t,"assert",(function(){return r.assert})),n.o(r,"decryptWithSharedKey")&&n.d(t,"decryptWithSharedKey",(function(){return r.decryptWithSharedKey})),n.o(r,"derive")&&n.d(t,"derive",(function(){return r.derive})),n.o(r,"encryptWithSharedKey")&&n.d(t,"encryptWithSharedKey",(function(){return r.encryptWithSharedKey})),n.o(r,"generateKeyPair")&&n.d(t,"generateKeyPair",(function(){return r.generateKeyPair})),n.o(r,"isConstantTime")&&n.d(t,"isConstantTime",(function(){return r.isConstantTime}))},function(e,t,n){"use strict"},function(e,t){},function(e,t,n){"use strict";function r(e,t){if(!e)throw new Error(t||"Assertion failed")}function i(e,t){if(e.length!==t.length)return!1;let n=0;for(let r=0;r<e.length;r++)n|=e[r]^t[r];return 0===n}n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return i}))},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"b",(function(){return o}));var r=n(9);async function i(e){return await Object(r.e)(e)}async function o(e){return await Object(r.f)(e)}},function(e,t,n){"use strict";n.d(t,"b",(function(){return a})),n.d(t,"a",(function(){return c}));var r=n(2),i=n(1),o=n(10);async function s(e){const t=await Object(r.sha512)(e);return{encryptionKey:Object(o.d)(t),macKey:Object(o.e)(t)}}async function a(e,t,n,a=Object(r.randomBytes)(r.IV_LENGTH)){const{encryptionKey:c,macKey:u}=await s(t),d=await Object(r.aesCbcEncrypt)(a,c,e),l=Object(i.concatArrays)(a,n,d),f=await Object(r.hmacSha256Sign)(u,l);return Object(o.h)({iv:a,publicKey:n,ciphertext:d,mac:f})}async function c(e,t){const{iv:n,publicKey:a,mac:c,ciphertext:u}=Object(o.b)(e),{encryptionKey:d,macKey:l}=await s(t),f=Object(i.concatArrays)(n,a,u),h=await Object(r.hmacSha256Verify)(l,f,c);Object(r.assert)(h,r.ERROR_BAD_MAC);return await Object(r.aesCbcDecrypt)(n,d,u)}},function(e,t,n){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <http://feross.org>
 * @license  MIT
 */
var r=n(82),i=n(83),o=n(84);function s(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function a(e,t){if(s()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,n){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return l(this,e)}return u(this,e,t,n)}function u(e,t,n,r){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,r){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(r||0))throw new RangeError("'length' is out of bounds");t=void 0===n&&void 0===r?new Uint8Array(t):void 0===r?new Uint8Array(t,n):new Uint8Array(t,n,r);c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=f(e,t);return e}(e,t,n,r):"string"==typeof t?function(e,t,n){"string"==typeof n&&""!==n||(n="utf8");if(!c.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var r=0|p(t,n),i=(e=a(e,r)).write(t,n);i!==r&&(e=e.slice(0,i));return e}(e,t,n):function(e,t){if(c.isBuffer(t)){var n=0|h(t.length);return 0===(e=a(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(r=t.length)!=r?a(e,0):f(e,t);if("Buffer"===t.type&&o(t.data))return f(e,t.data)}var r;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function d(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function l(e,t){if(d(t),e=a(e,t<0?0:0|h(t)),!c.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function f(e,t){var n=t.length<0?0:0|h(t.length);e=a(e,n);for(var r=0;r<n;r+=1)e[r]=255&t[r];return e}function h(e){if(e>=s())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+s().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var r=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return K(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return G(e).length;default:if(r)return K(e).length;t=(""+t).toLowerCase(),r=!0}}function g(e,t,n){var r=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return A(this,t,n);case"utf8":case"utf-8":return N(this,t,n);case"ascii":return I(this,t,n);case"latin1":case"binary":return w(this,t,n);case"base64":return b(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,n);default:if(r)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),r=!0}}function y(e,t,n){var r=e[t];e[t]=e[n],e[n]=r}function E(e,t,n,r,i){if(0===e.length)return-1;if("string"==typeof n?(r=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=c.from(t,r)),c.isBuffer(t))return 0===t.length?-1:_(e,t,n,r,i);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):_(e,[t],n,r,i);throw new TypeError("val must be string, number or Buffer")}function _(e,t,n,r,i){var o,s=1,a=e.length,c=t.length;if(void 0!==r&&("ucs2"===(r=String(r).toLowerCase())||"ucs-2"===r||"utf16le"===r||"utf-16le"===r)){if(e.length<2||t.length<2)return-1;s=2,a/=2,c/=2,n/=2}function u(e,t){return 1===s?e[t]:e.readUInt16BE(t*s)}if(i){var d=-1;for(o=n;o<a;o++)if(u(e,o)===u(t,-1===d?0:o-d)){if(-1===d&&(d=o),o-d+1===c)return d*s}else-1!==d&&(o-=o-d),d=-1}else for(n+c>a&&(n=a-c),o=n;o>=0;o--){for(var l=!0,f=0;f<c;f++)if(u(e,o+f)!==u(t,f)){l=!1;break}if(l)return o}return-1}function v(e,t,n,r){n=Number(n)||0;var i=e.length-n;r?(r=Number(r))>i&&(r=i):r=i;var o=t.length;if(o%2!=0)throw new TypeError("Invalid hex string");r>o/2&&(r=o/2);for(var s=0;s<r;++s){var a=parseInt(t.substr(2*s,2),16);if(isNaN(a))return s;e[n+s]=a}return s}function m(e,t,n,r){return V(K(t,e.length-n),e,n,r)}function R(e,t,n,r){return V(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,r)}function S(e,t,n,r){return R(e,t,n,r)}function T(e,t,n,r){return V(G(t),e,n,r)}function O(e,t,n,r){return V(function(e,t){for(var n,r,i,o=[],s=0;s<e.length&&!((t-=2)<0);++s)n=e.charCodeAt(s),r=n>>8,i=n%256,o.push(i),o.push(r);return o}(t,e.length-n),e,n,r)}function b(e,t,n){return 0===t&&n===e.length?r.fromByteArray(e):r.fromByteArray(e.slice(t,n))}function N(e,t,n){n=Math.min(e.length,n);for(var r=[],i=t;i<n;){var o,s,a,c,u=e[i],d=null,l=u>239?4:u>223?3:u>191?2:1;if(i+l<=n)switch(l){case 1:u<128&&(d=u);break;case 2:128==(192&(o=e[i+1]))&&(c=(31&u)<<6|63&o)>127&&(d=c);break;case 3:o=e[i+1],s=e[i+2],128==(192&o)&&128==(192&s)&&(c=(15&u)<<12|(63&o)<<6|63&s)>2047&&(c<55296||c>57343)&&(d=c);break;case 4:o=e[i+1],s=e[i+2],a=e[i+3],128==(192&o)&&128==(192&s)&&128==(192&a)&&(c=(15&u)<<18|(63&o)<<12|(63&s)<<6|63&a)>65535&&c<1114112&&(d=c)}null===d?(d=65533,l=1):d>65535&&(d-=65536,r.push(d>>>10&1023|55296),d=56320|1023&d),r.push(d),i+=l}return function(e){var t=e.length;if(t<=4096)return String.fromCharCode.apply(String,e);var n="",r=0;for(;r<t;)n+=String.fromCharCode.apply(String,e.slice(r,r+=4096));return n}(r)}t.Buffer=c,t.SlowBuffer=function(e){+e!=e&&(e=0);return c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=s(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,n){return u(null,e,t,n)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,n){return function(e,t,n,r){return d(t),t<=0?a(e,t):void 0!==n?"string"==typeof r?a(e,t).fill(n,r):a(e,t).fill(n):a(e,t)}(null,e,t,n)},c.allocUnsafe=function(e){return l(null,e)},c.allocUnsafeSlow=function(e){return l(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,r=t.length,i=0,o=Math.min(n,r);i<o;++i)if(e[i]!==t[i]){n=e[i],r=t[i];break}return n<r?-1:r<n?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!o(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var r=c.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!c.isBuffer(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(r,i),i+=s.length}return r},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)y(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)y(this,t,t+3),y(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)y(this,t,t+7),y(this,t+1,t+6),y(this,t+2,t+5),y(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?N(this,0,e):g.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",n=t.INSPECT_MAX_BYTES;return this.length>0&&(e=this.toString("hex",0,n).match(/.{2}/g).join(" "),this.length>n&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,n,r,i){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===r&&(r=0),void 0===i&&(i=this.length),t<0||n>e.length||r<0||i>this.length)throw new RangeError("out of range index");if(r>=i&&t>=n)return 0;if(r>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var o=(i>>>=0)-(r>>>=0),s=(n>>>=0)-(t>>>=0),a=Math.min(o,s),u=this.slice(r,i),d=e.slice(t,n),l=0;l<a;++l)if(u[l]!==d[l]){o=u[l],s=d[l];break}return o<s?-1:s<o?1:0},c.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},c.prototype.indexOf=function(e,t,n){return E(this,e,t,n,!0)},c.prototype.lastIndexOf=function(e,t,n){return E(this,e,t,n,!1)},c.prototype.write=function(e,t,n,r){if(void 0===t)r="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)r=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===r&&(r="utf8")):(r=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");r||(r="utf8");for(var o=!1;;)switch(r){case"hex":return v(this,e,t,n);case"utf8":case"utf-8":return m(this,e,t,n);case"ascii":return R(this,e,t,n);case"latin1":case"binary":return S(this,e,t,n);case"base64":return T(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return O(this,e,t,n);default:if(o)throw new TypeError("Unknown encoding: "+r);r=(""+r).toLowerCase(),o=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function I(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(127&e[i]);return r}function w(e,t,n){var r="";n=Math.min(e.length,n);for(var i=t;i<n;++i)r+=String.fromCharCode(e[i]);return r}function A(e,t,n){var r=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>r)&&(n=r);for(var i="",o=t;o<n;++o)i+=H(e[o]);return i}function P(e,t,n){for(var r=e.slice(t,n),i="",o=0;o<r.length;o+=2)i+=String.fromCharCode(r[o]+256*r[o+1]);return i}function C(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function U(e,t,n,r,i,o){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<o)throw new RangeError('"value" argument is out of bounds');if(n+r>e.length)throw new RangeError("Index out of range")}function D(e,t,n,r){t<0&&(t=65535+t+1);for(var i=0,o=Math.min(e.length-n,2);i<o;++i)e[n+i]=(t&255<<8*(r?i:1-i))>>>8*(r?i:1-i)}function L(e,t,n,r){t<0&&(t=4294967295+t+1);for(var i=0,o=Math.min(e.length-n,4);i<o;++i)e[n+i]=t>>>8*(r?i:3-i)&255}function M(e,t,n,r,i,o){if(n+r>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function x(e,t,n,r,o){return o||M(e,0,n,4),i.write(e,t,n,r,23,4),n+4}function j(e,t,n,r,o){return o||M(e,0,n,8),i.write(e,t,n,r,52,8),n+8}c.prototype.slice=function(e,t){var n,r=this.length;if((e=~~e)<0?(e+=r)<0&&(e=0):e>r&&(e=r),(t=void 0===t?r:~~t)<0?(t+=r)<0&&(t=0):t>r&&(t=r),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=c.prototype;else{var i=t-e;n=new c(i,void 0);for(var o=0;o<i;++o)n[o]=this[o+e]}return n},c.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r},c.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e+--t],i=1;t>0&&(i*=256);)r+=this[e+--t]*i;return r},c.prototype.readUInt8=function(e,t){return t||C(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||C(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||C(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||C(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||C(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=this[e],i=1,o=0;++o<t&&(i*=256);)r+=this[e+o]*i;return r>=(i*=128)&&(r-=Math.pow(2,8*t)),r},c.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||C(e,t,this.length);for(var r=t,i=1,o=this[e+--r];r>0&&(i*=256);)o+=this[e+--r]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},c.prototype.readInt8=function(e,t){return t||C(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||C(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt16BE=function(e,t){t||C(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},c.prototype.readInt32LE=function(e,t){return t||C(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||C(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||C(e,4,this.length),i.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||C(e,8,this.length),i.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||U(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,o=0;for(this[t]=255&e;++o<n&&(i*=256);)this[t+o]=e/i&255;return t+n},c.prototype.writeUIntBE=function(e,t,n,r){(e=+e,t|=0,n|=0,r)||U(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,o=1;for(this[t+i]=255&e;--i>=0&&(o*=256);)this[t+i]=e/o&255;return t+n},c.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):L(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);U(this,e,t,n,i-1,-i)}var o=0,s=1,a=0;for(this[t]=255&e;++o<n&&(s*=256);)e<0&&0===a&&0!==this[t+o-1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeIntBE=function(e,t,n,r){if(e=+e,t|=0,!r){var i=Math.pow(2,8*n-1);U(this,e,t,n,i-1,-i)}var o=n-1,s=1,a=0;for(this[t+o]=255&e;--o>=0&&(s*=256);)e<0&&0===a&&0!==this[t+o+1]&&(a=1),this[t+o]=(e/s>>0)-a&255;return t+n},c.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):D(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):D(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):L(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||U(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):L(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,n){return x(this,e,t,!0,n)},c.prototype.writeFloatBE=function(e,t,n){return x(this,e,t,!1,n)},c.prototype.writeDoubleLE=function(e,t,n){return j(this,e,t,!0,n)},c.prototype.writeDoubleBE=function(e,t,n){return j(this,e,t,!1,n)},c.prototype.copy=function(e,t,n,r){if(n||(n=0),r||0===r||(r=this.length),t>=e.length&&(t=e.length),t||(t=0),r>0&&r<n&&(r=n),r===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(r<0)throw new RangeError("sourceEnd out of bounds");r>this.length&&(r=this.length),e.length-t<r-n&&(r=e.length-t+n);var i,o=r-n;if(this===e&&n<t&&t<r)for(i=o-1;i>=0;--i)e[i+t]=this[i+n];else if(o<1e3||!c.TYPED_ARRAY_SUPPORT)for(i=0;i<o;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+o),t);return o},c.prototype.fill=function(e,t,n,r){if("string"==typeof e){if("string"==typeof t?(r=t,t=0,n=this.length):"string"==typeof n&&(r=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==r&&"string"!=typeof r)throw new TypeError("encoding must be a string");if("string"==typeof r&&!c.isEncoding(r))throw new TypeError("Unknown encoding: "+r)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var o;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(o=t;o<n;++o)this[o]=e;else{var s=c.isBuffer(e)?e:K(new c(e,r).toString()),a=s.length;for(o=0;o<n-t;++o)this[o+t]=s[o%a]}return this};var q=/[^+\/0-9A-Za-z-_]/g;function H(e){return e<16?"0"+e.toString(16):e.toString(16)}function K(e,t){var n;t=t||1/0;for(var r=e.length,i=null,o=[],s=0;s<r;++s){if((n=e.charCodeAt(s))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&o.push(239,191,189);continue}if(s+1===r){(t-=3)>-1&&o.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&o.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&o.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;o.push(n)}else if(n<2048){if((t-=2)<0)break;o.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;o.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;o.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return o}function G(e){return r.toByteArray(function(e){if((e=function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}(e).replace(q,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function V(e,t,n,r){for(var i=0;i<r&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}}).call(this,n(27))},function(e,t){e.exports=i,i.strict=o,i.loose=s;var n=Object.prototype.toString,r={"[object Int8Array]":!0,"[object Int16Array]":!0,"[object Int32Array]":!0,"[object Uint8Array]":!0,"[object Uint8ClampedArray]":!0,"[object Uint16Array]":!0,"[object Uint32Array]":!0,"[object Float32Array]":!0,"[object Float64Array]":!0};function i(e){return o(e)||s(e)}function o(e){return e instanceof Int8Array||e instanceof Int16Array||e instanceof Int32Array||e instanceof Uint8Array||e instanceof Uint8ClampedArray||e instanceof Uint16Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array}function s(e){return r[n.call(e)]}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PINO_CUSTOM_CONTEXT_KEY=t.PINO_LOGGER_DEFAULTS=void 0,t.PINO_LOGGER_DEFAULTS={level:"info",prettyPrint:{colorize:!0,translateTime:"SYS:standard",ignore:"pid,hostname"}},t.PINO_CUSTOM_CONTEXT_KEY="custom_context"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.JsonRpcHistory=void 0;const r=n(8),i=n(12),o=n(16),s=n(15),a=n(6),c=n(20),u=n(14);class d extends o.IJsonRpcHistory{constructor(e,t){super(e,t),this.client=e,this.logger=t,this.records=new Map,this.events=new i.EventEmitter,this.context=u.HISTORY_CONTEXT,this.cached=[],this.client,this.logger=c.generateChildLogger(t,this.context),this.registerEventListeners()}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.restore()}))}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(t=>{if(void 0!==t.response)return;const n={topic:t.topic,request:a.formatJsonRpcRequest(t.request.method,t.request.params,t.id),chainId:t.chainId};return e.push(n)}),e}set(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){if(yield this.isEnabled(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:e,request:t,chainId:n}),this.records.has(t.id)){const e=s.ERROR.RECORD_ALREADY_EXISTS.format({context:this.getHistoryContext(),id:t.id});throw this.logger.error(e.message),new Error(e.message)}const r={id:t.id,topic:e,request:{method:t.method,params:t.params||null},chainId:n};this.records.set(r.id,r),this.events.emit(u.HISTORY_EVENTS.created,r)}))}update(e,t){return r.__awaiter(this,void 0,void 0,(function*(){if(yield this.isEnabled(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",topic:e,response:t}),!this.records.has(t.id))return;const n=yield this.getRecord(t.id);n.topic===e&&void 0===n.response&&(n.response=a.isJsonRpcError(t)?{error:t.error}:{result:t.result},this.records.set(n.id,n),this.events.emit(u.HISTORY_EVENTS.updated,n))}))}get(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:e,id:t});const n=yield this.getRecord(t);if(n.topic!==e){const e=s.ERROR.MISMATCHED_TOPIC.format({context:this.getHistoryContext(),id:t});throw this.logger.error(e.message),new Error(e.message)}return n}))}delete(e,t){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:t}),this.values.forEach(n=>{if(n.topic===e){if(void 0!==t&&n.id!==t)return;this.records.delete(n.id),this.events.emit(u.HISTORY_EVENTS.deleted,n)}})}))}exists(e,t){return r.__awaiter(this,void 0,void 0,(function*(){if(yield this.isEnabled(),!this.records.has(t))return!1;return(yield this.getRecord(t)).topic===e}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}getNestedContext(e){const t=c.getLoggerContext(this.logger).split("/");return t.slice(t.length-e,t.length)}getHistoryContext(){return this.getNestedContext(2).join(" ")}getStorageKey(){return`${`${this.client.protocol}@${this.client.version}:${this.client.context}`}//${this.getNestedContext(2).join(":")}`}getRecord(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.isEnabled();const t=this.records.get(e);if(!t){const t=s.ERROR.NO_MATCHING_ID.format({context:this.getHistoryContext(),id:e});throw this.logger.error(t.message),new Error(t.message)}return t}))}persist(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.client.storage.setItem(this.getStorageKey(),this.values),this.events.emit(u.HISTORY_EVENTS.sync)}))}restore(){return r.__awaiter(this,void 0,void 0,(function*(){try{const e=yield this.client.storage.getItem(this.getStorageKey());if(void 0===e)return;if(!e.length)return;if(this.records.size){const e=s.ERROR.RESTORE_WILL_OVERRIDE.format({context:this.getHistoryContext()});throw this.logger.error(e.message),new Error(e.message)}this.cached=e,yield Promise.all(this.cached.map(e=>r.__awaiter(this,void 0,void 0,(function*(){this.records.set(e.id,e)})))),yield this.enable(),this.logger.debug("Successfully Restored records for "+this.getHistoryContext()),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug("Failed to Restore records for "+this.getHistoryContext()),this.logger.error(e)}}))}reset(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.disable(),yield Promise.all(this.cached.map(e=>r.__awaiter(this,void 0,void 0,(function*(){this.records.set(e.id,e)})))),yield this.enable()}))}isEnabled(){return r.__awaiter(this,void 0,void 0,(function*(){if(this.cached.length)return new Promise(e=>{this.events.once(u.HISTORY_EVENTS.enabled,()=>e())})}))}enable(){return r.__awaiter(this,void 0,void 0,(function*(){this.cached=[],this.events.emit(u.HISTORY_EVENTS.enabled)}))}disable(){return r.__awaiter(this,void 0,void 0,(function*(){this.cached.length||(this.cached=this.values),this.events.emit(u.HISTORY_EVENTS.disabled)}))}registerEventListeners(){this.events.on(u.HISTORY_EVENTS.created,e=>{const t=u.HISTORY_EVENTS.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(u.HISTORY_EVENTS.updated,e=>{const t=u.HISTORY_EVENTS.updated;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,record:e}),this.persist()}),this.events.on(u.HISTORY_EVENTS.deleted,e=>{const t=u.HISTORY_EVENTS.deleted;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,record:e}),this.persist()})}}t.JsonRpcHistory=d},function(e,t,n){"use strict";n.r(t),n.d(t,"isNodeJs",(function(){return o}));var r=n(4);for(var i in r)["default","isNodeJs"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);const o=r.isNode},function(e,t,n){"use strict";n.d(t,"e",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"d",(function(){return a})),n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return u}));var r=n(18),i=n(3);function o(){return Date.now()*Math.pow(10,3)+Math.floor(Math.random()*Math.pow(10,3))}function s(e,t,n){return{id:n||o(),jsonrpc:"2.0",method:e,params:t}}function a(e,t){return{id:e,jsonrpc:"2.0",result:t}}function c(e,t){return{id:e,jsonrpc:"2.0",error:u(t)}}function u(e){return void 0===e?Object(r.a)(i.a):("string"==typeof e&&(e=Object.assign(Object.assign({},Object(r.a)(i.g)),{message:e})),Object(r.c)(e.code)&&(e=Object(r.b)(e.code)),e)}},function(e,t,n){"use strict";function r(e){return e.includes("*")?o(e):!/\W/g.test(e)}function i(e){return"*"===e}function o(e){return!!i(e)||!!e.includes("*")&&(2===e.split("*").length&&1===e.split("*").filter(e=>""===e.trim()).length)}function s(e){return!i(e)&&o(e)&&!e.split("*")[0].trim()}function a(e){return!i(e)&&o(e)&&!e.split("*")[1].trim()}n.d(t,"c",(function(){return r})),n.d(t,"a",(function(){return i})),n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return a}))},function(e,t,n){"use strict";n.r(t);var r=n(7);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i)},function(e,t,n){"use strict";n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return o})),n.d(t,"b",(function(){return s}));function r(e,t){const n=function(e){const t=e.match(new RegExp(/^\w+:/,"gi"));if(t&&t.length)return t[0]}(e);return void 0!==n&&new RegExp(t).test(n)}function i(e){return r(e,"^https?:")}function o(e){return r(e,"^wss?:")}function s(e){return new RegExp("wss?://localhost(:d{2,5})?").test(e)}},function(e,t,n){"use strict";function r(e){return"id"in e&&"jsonrpc"in e&&"2.0"===e.jsonrpc}function i(e){return r(e)&&"method"in e}function o(e){return r(e)&&(s(e)||a(e))}function s(e){return"result"in e}function a(e){return"error"in e}function c(e){return"error"in e&&!1===e.valid}n.d(t,"b",(function(){return r})),n.d(t,"c",(function(){return i})),n.d(t,"d",(function(){return o})),n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return a})),n.d(t,"f",(function(){return c}))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Engine=void 0;const r=n(8),i=n(16),o=n(15),s=n(6),a=n(14);class c extends i.IEngine{constructor(e){super(e),this.sequence=e,this.registerEventListeners()}find(e){return r.__awaiter(this,void 0,void 0,(function*(){return this.sequence.values.filter(t=>{var n,r,i,s,a,c;let u=!1;return(null===(n=t.permissions)||void 0===n?void 0:n.jsonrpc)&&(null===(r=e.jsonrpc)||void 0===r?void 0:r.methods)&&o.hasOverlap(e.jsonrpc.methods,t.permissions.jsonrpc.methods)&&(u=!0),(null===(i=t.permissions)||void 0===i?void 0:i.blockchain)&&(null===(s=e.blockchain)||void 0===s?void 0:s.chains)&&o.hasOverlap(e.blockchain.chains,t.permissions.blockchain.chains)&&(u=!0),(null===(a=t.permissions)||void 0===a?void 0:a.notifications)&&(null===(c=e.notifications)||void 0===c?void 0:c.types)&&o.hasOverlap(e.notifications.types,t.permissions.notifications.types)&&(u=!0),u})}))}ping(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n={method:this.sequence.config.jsonrpc.ping,params:{}};return this.request({topic:e,request:n,timeout:t||1e3*a.THIRTY_SECONDS})}))}send(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.sequence.settled.get(e);if(s.isJsonRpcRequest(t)){if(!Object.values(this.sequence.config.jsonrpc).includes(t.method)){yield this.isJsonRpcAuthorized(e,r.self,t),yield this.sequence.validateRequest({topic:e,request:t,chainId:n}),yield this.sequence.history.set(e,t,n);const i={chainId:n,request:{method:t.method,params:t.params}};i.chainId||delete i.chainId,t=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.payload,i,t.id)}}else yield this.sequence.history.update(e,t);yield this.sequence.client.relayer.publish(r.topic,t,{relay:r.relay})}))}get length(){return this.sequence.settled.length}get topics(){return this.sequence.settled.topics}get values(){return this.sequence.settled.values.map(e=>e.data)}create(e){return new Promise((t,n)=>r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Create "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"create",params:e});const i=(null==e?void 0:e.timeout)||1e3*a.FIVE_MINUTES,s=setTimeout(()=>{const e=o.ERROR.SETTLE_TIMEOUT.format({context:this.sequence.context,timeout:i});this.sequence.logger.error(e.message),n(e.message)},i);let c;try{c=yield this.propose(e)}catch(e){return clearTimeout(s),n(e)}this.sequence.pending.on(a.SUBSCRIPTION_EVENTS.updated,e=>r.__awaiter(this,void 0,void 0,(function*(){if(c.topic===e.data.topic&&o.isSequenceResponded(e.data)){const r=e.data.outcome;if(clearTimeout(s),o.isSequenceFailed(r)){try{yield this.sequence.pending.delete(c.topic,r.reason)}catch(e){return n(e)}n(new Error(r.reason.message))}else try{const e=yield this.sequence.settled.get(r.topic),n=o.ERROR.SETTLED.format({context:this.sequence.context});yield this.sequence.pending.delete(c.topic,n),t(e)}catch(e){return n(e)}}})))})))}respond(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Respond "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"respond",params:e}),yield this.sequence.validateRespond(e);const{approved:t,proposal:n,response:r}=e,{relay:i,ttl:s}=n,a={publicKey:yield this.sequence.client.crypto.generateKeyPair(),metadata:null==r?void 0:r.metadata};if(a.metadata||delete a.metadata,!t){const t=o.ERROR.NOT_APPROVED.format({context:this.sequence.context}),r={reason:(null==e?void 0:e.reason)||t},s={status:this.sequence.config.status.responded,topic:n.topic,relay:i,self:a,proposal:n,outcome:r};return yield this.sequence.pending.set(s.topic,s,{relay:s.relay}),s}try{const e={publicKey:a.publicKey,metadata:null==r?void 0:r.metadata};e.metadata||delete e.metadata;const t=Date.now()+1e3*n.ttl,o=(null==r?void 0:r.state)||{},c={publicKey:n.proposer.publicKey,metadata:n.proposer.metadata};c.metadata||delete c.metadata;const u=n.proposer.controller?{publicKey:c.publicKey}:{publicKey:a.publicKey},d=Object.assign(Object.assign({},n.permissions),{controller:u}),l={topic:(yield this.settle({relay:i,self:a,peer:c,permissions:d,state:o,ttl:s,expiry:t})).topic,relay:i,state:o,responder:e,expiry:t},f={status:this.sequence.config.status.responded,topic:n.topic,relay:i,self:a,proposal:n,outcome:l};return yield this.sequence.pending.set(f.topic,f,{relay:f.relay}),f}catch(e){const t={reason:o.ERROR.GENERIC.format({message:e.message})},r={status:this.sequence.config.status.responded,topic:n.topic,relay:i,self:a,proposal:n,outcome:t};return yield this.sequence.pending.set(r.topic,r,{relay:r.relay}),r}}))}update(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Update "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"update",params:e});const t=yield this.sequence.settled.get(e.topic),n={publicKey:t.self.publicKey},r=yield this.handleUpdate(e.topic,e,n),i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.update,r);return yield this.send(t.topic,i),t}))}upgrade(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Upgrade "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"upgrade",params:e});const t=yield this.sequence.settled.get(e.topic),n={publicKey:t.self.publicKey},r=yield this.handleUpgrade(e.topic,e,n),i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.upgrade,r);return yield this.send(t.topic,i),t}))}request(e){return r.__awaiter(this,void 0,void 0,(function*(){return new Promise((t,n)=>r.__awaiter(this,void 0,void 0,(function*(){try{yield this.sequence.validateRequest(e)}catch(e){return n(e)}const r=s.formatJsonRpcRequest(e.request.method,e.request.params),i=(null==e?void 0:e.timeout)||1e3*a.FIVE_MINUTES,c=setTimeout(()=>{const e=o.ERROR.JSONRPC_REQUEST_TIMEOUT.format({method:r.method,timeout:i});this.sequence.logger.error(e.message),n(e.message)},i);this.sequence.events.on(this.sequence.config.events.response,i=>{if(e.topic!==i.topic)return;const o=i.response;if(o.id===r.id){if(clearTimeout(c),s.isJsonRpcError(o)){const e=o.error.message;return this.sequence.logger.error(e),n(new Error(e))}return t(o.result)}});try{yield this.send(e.topic,r,null==e?void 0:e.chainId)}catch(e){return clearTimeout(c),n(e)}})))}))}delete(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Delete "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"delete",params:e}),yield this.sequence.settled.delete(e.topic,e.reason)}))}notify(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=yield this.sequence.settled.get(e.topic);yield this.isNotificationAuthorized(e.topic,t.self,e.type);const n={type:e.type,data:e.data},r=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.notification,n);yield this.send(e.topic,r)}))}propose(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Propose "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"propose",params:e}),yield this.sequence.validatePropose(e);const t=(null==e?void 0:e.relay)||{protocol:a.RELAYER_DEFAULT_PROTOCOL},n=o.generateRandomBytes32(),r={publicKey:yield this.sequence.client.crypto.generateKeyPair(),metadata:null==e?void 0:e.metadata};r.metadata||delete r.metadata;const i={publicKey:r.publicKey,controller:this.sequence.client.controller,metadata:r.metadata};i.metadata||delete i.metadata;const s={relay:t,topic:n,proposer:i,signal:(null==e?void 0:e.signal)||(yield this.sequence.getDefaultSignal({topic:n,relay:t,proposer:i})),permissions:(null==e?void 0:e.permissions)||(yield this.sequence.getDefaultPermissions()),ttl:(null==e?void 0:e.ttl)||(yield this.sequence.getDefaultTTL())},c={status:this.sequence.config.status.proposed,topic:s.topic,relay:s.relay,self:r,proposal:s};return yield this.sequence.pending.set(c.topic,c,{relay:t}),c}))}settle(e){return r.__awaiter(this,void 0,void 0,(function*(){this.sequence.logger.debug("Settle "+this.sequence.context),this.sequence.logger.trace({type:"method",method:"settle",params:e});const t={topic:yield this.sequence.client.crypto.generateSharedKey(e.self,e.peer),relay:e.relay,self:e.self,peer:e.peer,permissions:e.permissions,expiry:e.expiry,state:e.state};return yield this.sequence.settled.set(t.topic,t,{relay:t.relay,expiry:t.expiry}),t}))}onResponse(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} response`),this.sequence.logger.trace({type:"method",method:"onResponse",topic:t,payload:n});const r=n,i=r.params,a=yield this.sequence.pending.get(t);let c;if(o.isSequenceFailed(i))this.sequence.logger.error(i.reason),yield this.sequence.pending.update(t,{status:this.sequence.config.status.responded,outcome:{reason:i.reason}});else{try{const e=a.proposal.proposer.controller?{publicKey:a.proposal.proposer.publicKey}:{publicKey:i.responder.publicKey},n={publicKey:i.responder.publicKey,metadata:i.responder.metadata};n.metadata||delete n.metadata;const r=i.state||{},o=Object.assign(Object.assign({},a.proposal.permissions),{controller:e}),s=yield this.settle({relay:a.relay,self:a.self,peer:n,permissions:o,ttl:a.proposal.ttl,expiry:i.expiry,state:r});yield this.sequence.pending.update(t,{status:this.sequence.config.status.responded,outcome:{topic:s.topic,relay:s.relay,responder:i.responder,expiry:s.expiry,state:s.state}})}catch(e){this.sequence.logger.error(e),c=o.ERROR.GENERIC.format({message:e.message}),yield this.sequence.pending.update(t,{status:this.sequence.config.status.responded,outcome:{reason:c}})}const e=void 0===c?s.formatJsonRpcResult(r.id,!0):s.formatJsonRpcError(r.id,c);yield this.sequence.client.relayer.publish(a.topic,e,{relay:a.relay})}}))}onAcknowledge(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} acknowledge`),this.sequence.logger.trace({type:"method",method:"onAcknowledge",topic:t,payload:n});const r=n,i=yield this.sequence.pending.get(t);if(!o.isSequenceResponded(i))return;s.isJsonRpcError(r)&&!o.isSequenceFailed(i.outcome)&&(yield this.sequence.settled.delete(i.outcome.topic,r.error));const a=o.ERROR.RESPONSE_ACKNOWLEDGED.format({context:this.sequence.context});yield this.sequence.pending.delete(t,a)}))}onMessage(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;if(this.sequence.logger.debug(`Receiving ${this.sequence.context} message`),this.sequence.logger.trace({type:"method",method:"onMessage",topic:t,payload:n}),s.isJsonRpcRequest(n)){const t=n,r=yield this.sequence.settled.get(e.topic);let i;switch(t.method){case this.sequence.config.jsonrpc.payload:yield this.onPayload(e);break;case this.sequence.config.jsonrpc.update:yield this.onUpdate(e);break;case this.sequence.config.jsonrpc.upgrade:yield this.onUpgrade(e);break;case this.sequence.config.jsonrpc.notification:yield this.onNotification(e);break;case this.sequence.config.jsonrpc.delete:yield this.sequence.settled.delete(r.topic,t.params.reason);break;case this.sequence.config.jsonrpc.ping:yield this.send(r.topic,s.formatJsonRpcResult(t.id,!0));break;default:i=o.ERROR.UNKNOWN_JSONRPC_METHOD.format({method:t.method}),this.sequence.logger.error(i.message),yield this.send(r.topic,s.formatJsonRpcError(t.id,i))}}else this.onPayloadEvent(e)}))}onPayload(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;if(s.isJsonRpcRequest(n)){const{id:e,params:r}=n,{chainId:i}=r,o=s.formatJsonRpcRequest(r.request.method,r.request.params,e),a=yield this.sequence.settled.get(t);yield this.isJsonRpcAuthorized(t,a.peer,o),yield this.sequence.validateRequest({topic:t,request:o,chainId:i});const c={topic:t,payload:o,chainId:i};this.sequence.logger.debug(`Receiving ${this.sequence.context} payload`),this.sequence.logger.trace(Object.assign({type:"method",method:"onPayload"},c)),this.onPayloadEvent(c)}else{const e={topic:t,payload:n};this.sequence.logger.debug(`Receiving ${this.sequence.context} payload`),this.sequence.logger.trace(Object.assign({type:"method",method:"onPayload"},e)),this.onPayloadEvent(e)}}))}onUpdate(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} update`),this.sequence.logger.trace({type:"method",method:"onUpdate",topic:t,payload:n});const r=e.payload,i=yield this.sequence.settled.get(e.topic);try{const e={publicKey:i.peer.publicKey};yield this.handleUpdate(t,r.params,e);const n=s.formatJsonRpcResult(r.id,!0);yield this.send(i.topic,n)}catch(e){this.sequence.logger.error(e);const t=s.formatJsonRpcError(r.id,e.message);yield this.send(i.topic,t)}}))}onUpgrade(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;this.sequence.logger.debug(`Receiving ${this.sequence.context} upgrade`),this.sequence.logger.trace({type:"method",method:"onUpgrade",topic:t,payload:n});const r=e.payload,i=yield this.sequence.settled.get(e.topic);try{const e={publicKey:i.peer.publicKey};yield this.handleUpgrade(t,r.params,e);const n=s.formatJsonRpcResult(r.id,!0);yield this.send(i.topic,n)}catch(e){this.sequence.logger.error(e);const t=s.formatJsonRpcError(r.id,e.message);yield this.send(i.topic,t)}}))}onNotification(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=e.payload.params,n=yield this.sequence.settled.get(e.topic);yield this.isNotificationAuthorized(e.topic,n.peer,t.type);const r={topic:e.topic,type:t.type,data:t.data},i=this.sequence.config.events.notification;this.sequence.logger.info("Emitting "+i),this.sequence.logger.debug({type:"event",event:i,notificationEvent:r}),this.sequence.events.emit(i,r)}))}handleUpdate(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===t.state){const e=o.ERROR.INVALID_UPDATE_REQUEST.format({context:this.sequence.context});throw this.sequence.logger.error(e.message),new Error(e.message)}const r=yield this.sequence.settled.get(e);if(n.publicKey!==r.permissions.controller.publicKey){const e=o.ERROR.UNAUTHORIZED_UPDATE_REQUEST.format({context:this.sequence.context});throw this.sequence.logger.error(e.message),new Error(e.message)}return r.state=yield this.sequence.mergeUpdate(e,t),yield this.sequence.settled.update(r.topic,r),t}))}handleUpgrade(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===t.permissions){const e=o.ERROR.INVALID_UPGRADE_REQUEST.format({context:this.sequence.context});throw this.sequence.logger.error(e.message),new Error(e.message)}const r=yield this.sequence.settled.get(e);if(n.publicKey!==r.permissions.controller.publicKey){const e=o.ERROR.UNAUTHORIZED_UPGRADE_REQUEST.format({context:this.sequence.context});throw this.sequence.logger.error(e.message),new Error(e.message)}return r.permissions=yield this.sequence.mergeUpgrade(e,t),yield this.sequence.settled.update(r.topic,r),t}))}isJsonRpcAuthorized(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.sequence.settled.get(e);if(t.publicKey!==r.permissions.controller.publicKey&&!r.permissions.jsonrpc.methods.includes(n.method)){const e=o.ERROR.UNAUTHORIZED_JSON_RPC_METHOD.format({method:n.method});throw this.sequence.logger.error(e.message),new Error(e.message)}}))}isNotificationAuthorized(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.sequence.settled.get(e);if(t.publicKey!==r.permissions.controller.publicKey&&r.self.publicKey!==r.permissions.controller.publicKey&&!r.permissions.notifications.types.includes(n)){const e=o.ERROR.UNAUTHORIZED_NOTIFICATION_TYPE.format({type:n});throw this.sequence.logger.error(e.message),new Error(e.message)}}))}shouldIgnorePayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n}=e;if(!this.sequence.settled.subscriptions.has(t))return!0;let r=!1;try{r=yield this.sequence.history.exists(t,n.id)}catch(e){}return r}))}onPayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const{topic:t,payload:n,chainId:r}=e;if(s.isJsonRpcRequest(n)){if(yield this.shouldIgnorePayloadEvent(e))return;yield this.sequence.history.set(t,n,r)}else yield this.sequence.history.update(t,n);if(s.isJsonRpcRequest(n)){const e={topic:t,request:n,chainId:r},i=this.sequence.config.events.request;this.sequence.logger.info("Emitting "+i),this.sequence.logger.debug({type:"event",event:i,data:e}),this.sequence.events.emit(i,e)}else{const e={topic:t,response:n,chainId:r},i=this.sequence.config.events.response;this.sequence.logger.info("Emitting "+i),this.sequence.logger.debug({type:"event",event:i,data:e}),this.sequence.events.emit(i,e)}}))}onPendingPayloadEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){if(s.isJsonRpcRequest(e.payload))switch(e.payload.method){case this.sequence.config.jsonrpc.approve:case this.sequence.config.jsonrpc.reject:this.onResponse(e)}else this.onAcknowledge(e)}))}onPendingStatusEvent(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=e.data;if(o.isSignalTypePairing(t.proposal.signal)&&!(yield this.sequence.client.crypto.hasKeys(t.proposal.topic))){const e=yield this.sequence.client.pairing.settled.get(t.proposal.signal.params.topic);yield this.sequence.client.crypto.generateSharedKey(e.self,e.peer,t.proposal.topic)}if(o.isSequenceResponded(t)){const n=this.sequence.config.events.responded;if(this.sequence.logger.info("Emitting "+n),this.sequence.logger.debug({type:"event",event:n,data:t}),this.sequence.events.emit(n,t),!o.isSubscriptionUpdatedEvent(e)){const e=o.isSequenceFailed(t.outcome)?this.sequence.config.jsonrpc.reject:this.sequence.config.jsonrpc.approve,n=s.formatJsonRpcRequest(e,t.outcome);yield this.sequence.client.relayer.publish(t.topic,n,{relay:t.relay})}}else{const e=this.sequence.config.events.proposed;if(this.sequence.logger.info("Emitting "+e),this.sequence.logger.debug({type:"event",event:e,data:t}),this.sequence.events.emit(e,t),o.isSignalTypePairing(t.proposal.signal)){const e=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.propose,t.proposal);yield this.sequence.client.pairing.send(t.proposal.signal.params.topic,e)}}}))}registerEventListeners(){this.sequence.pending.on(a.SUBSCRIPTION_EVENTS.payload,e=>this.onPendingPayloadEvent(e)),this.sequence.pending.on(a.SUBSCRIPTION_EVENTS.created,e=>this.onPendingStatusEvent(e)),this.sequence.pending.on(a.SUBSCRIPTION_EVENTS.updated,e=>this.onPendingStatusEvent(e)),this.sequence.settled.on(a.SUBSCRIPTION_EVENTS.payload,e=>this.onMessage(e)),this.sequence.settled.on(a.SUBSCRIPTION_EVENTS.created,e=>{const{data:t}=e,n=this.sequence.config.events.settled;this.sequence.logger.info("Emitting "+n),this.sequence.logger.debug({type:"event",event:n,data:t}),this.sequence.events.emit(n,t)}),this.sequence.settled.on(a.SUBSCRIPTION_EVENTS.updated,e=>{const{data:t,update:n}=e,r=this.sequence.config.events.updated;this.sequence.logger.info("Emitting "+r),this.sequence.logger.debug({type:"event",event:r,data:t,update:n}),this.sequence.events.emit(r,t,n)}),this.sequence.settled.on(a.SUBSCRIPTION_EVENTS.deleted,e=>r.__awaiter(this,void 0,void 0,(function*(){const{data:t,reason:n}=e,r=this.sequence.config.events.deleted;this.sequence.logger.info("Emitting "+r),this.sequence.logger.debug({type:"event",event:r,data:t,reason:n}),this.sequence.events.emit(r,t,n);const i=s.formatJsonRpcRequest(this.sequence.config.jsonrpc.delete,{reason:n});yield this.sequence.history.delete(t.topic),yield this.sequence.client.relayer.publish(t.topic,i,{relay:t.relay})}))),this.sequence.settled.on(a.SUBSCRIPTION_EVENTS.sync,()=>this.sequence.events.emit(this.sequence.config.events.sync)),this.sequence.settled.on(a.SUBSCRIPTION_EVENTS.enabled,()=>this.sequence.events.emit(this.sequence.config.events.enabled)),this.sequence.settled.on(a.SUBSCRIPTION_EVENTS.disabled,()=>this.sequence.events.emit(this.sequence.config.events.disabled))}}t.Engine=c},function(e,t){},function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return s})),n.d(t,"d",(function(){return a})),n.d(t,"c",(function(){return c}));var r=n(5),i=n(11);function o(e){if(!Object(i.d)(e.method))throw new Error("JSON-RPC Request has invalid subscribe method");if(!Object(i.e)(e.params))throw new Error("JSON-RPC Request has invalid subscribe params");const t=e.params;return Object(r.a)(t,"topic"),t}function s(e){if(!Object(i.a)(e.method))throw new Error("JSON-RPC Request has invalid publish method");if(!Object(i.b)(e.params))throw new Error("JSON-RPC Request has invalid publish params");const t=e.params;return Object(r.a)(t,"topic"),Object(r.a)(t,"message"),Object(r.a)(t,"ttl","number"),t}function a(e){if(!Object(i.j)(e.method))throw new Error("JSON-RPC Request has invalid unsubscribe method");if(!Object(i.k)(e.params))throw new Error("JSON-RPC Request has invalid unsubscribe params");const t=e.params;return Object(r.a)(t,"id"),t}function c(e){if(!Object(i.g)(e.method))throw new Error("JSON-RPC Request has invalid subscription method");if(!Object(i.h)(e.params))throw new Error("JSON-RPC Request has invalid subscription params");const t=e.params;return Object(r.a)(t,"id"),Object(r.a)(t,"data"),t}},function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));const r={waku:{info:"waku_info",connect:"waku_connect",disconnect:"waku_disconnect",publish:"waku_publish",subscribe:"waku_subscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe"}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getWindowMetadata=void 0;const r=n(24);t.getWindowMetadata=function(){let e,t;try{e=r.getDocumentOrThrow(),t=r.getLocationOrThrow()}catch(e){return null}function n(...t){const n=e.getElementsByTagName("meta");for(let e=0;e<n.length;e++){const r=n[e],i=["itemprop","property","name"].map(e=>r.getAttribute(e)).filter(e=>!!e&&t.includes(e));if(i.length&&i){const e=r.getAttribute("content");if(e)return e}}return""}const i=function(){let t=n("name","og:site_name","og:title","twitter:title");return t||(t=e.title),t}();return{description:n("description","og:description","twitter:description","keywords"),url:t.origin,icons:function(){const n=e.getElementsByTagName("link"),r=[];for(let e=0;e<n.length;e++){const i=n[e],o=i.getAttribute("rel");if(o&&o.toLowerCase().indexOf("icon")>-1){const e=i.getAttribute("href");if(e)if(-1===e.toLowerCase().indexOf("https:")&&-1===e.toLowerCase().indexOf("http:")&&0!==e.indexOf("//")){let n=t.protocol+"//"+t.host;if(0===e.indexOf("/"))n+=e;else{const r=t.pathname.split("/");r.pop();n+=r.join("/")+"/"+e}r.push(n)}else if(0===e.indexOf("//")){const n=t.protocol+e;r.push(n)}else r.push(e)}}return r}(),name:i}}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const r=n(8),i=n(71);r.__exportStar(n(14),t),t.Client=i.Client,t.default=i.Client},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Client=void 0;const r=n(8),i=n(12),o=r.__importDefault(n(72)),s=r.__importDefault(n(74)),a=n(16),c=n(15),u=n(20),d=n(98),l=n(14),f=n(112);class h extends a.IClient{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new i.EventEmitter,this.context=l.CLIENT_CONTEXT;const t=void 0!==(null==e?void 0:e.logger)&&"string"!=typeof(null==e?void 0:e.logger)?e.logger:o.default(u.getDefaultLoggerOptions({level:(null==e?void 0:e.logger)||"error"}));this.context=(null==e?void 0:e.name)||this.context,this.controller=(null==e?void 0:e.controller)||!1,this.metadata=(null==e?void 0:e.metadata)||c.getAppMetadata();const n=(null==e?void 0:e.storage)||new s.default(Object.assign(Object.assign({},l.CLIENT_STORAGE_OPTIONS),null==e?void 0:e.storageOptions));this.logger=u.generateChildLogger(t,this.context),this.crypto=new f.Crypto(this,(null==e?void 0:e.keychain)||new f.KeyChain(this,n)),this.relayer=new d.Relayer(this,this.logger,null==e?void 0:e.relayProvider),this.storage=n,this.pairing=new d.Pairing(this,this.logger),this.session=new d.Session(this,this.logger)}static init(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=new h(e);return yield t.initialize(),t}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}connect(e){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Connecting Application"),this.logger.trace({type:"method",method:"connect",params:e});try{void 0===typeof e.pairing&&this.logger.info("Connecing with existing pairing");const t=void 0===e.pairing?yield this.pairing.create():yield this.pairing.get(e.pairing.topic);this.logger.trace({type:"method",method:"connect",pairing:t});const n=e.metadata||this.metadata;if(void 0===n){const e=c.ERROR.MISSING_OR_INVALID.format({name:"app metadata"});throw this.logger.error(e.message),new Error(e.message)}const r=yield this.session.create({signal:{method:l.SESSION_SIGNAL_METHOD_PAIRING,params:{topic:t.topic}},relay:e.relay||{protocol:l.RELAYER_DEFAULT_PROTOCOL},metadata:n,permissions:Object.assign(Object.assign({},e.permissions),{notifications:l.SESSION_EMPTY_PERMISSIONS.notifications})});return this.logger.debug("Application Connection Successful"),this.logger.trace({type:"method",method:"connect",session:r}),r}catch(e){throw this.logger.debug("Application Connection Failure"),this.logger.error(e),e}}))}pair(e){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Pairing"),this.logger.trace({type:"method",method:"pair",params:e});const t=function(e){const t=c.parseUri(e);return{topic:t.topic,relay:t.relay,proposer:{publicKey:t.publicKey,controller:t.controller},signal:{method:l.PAIRING_SIGNAL_METHOD_URI,params:{uri:e}},permissions:{jsonrpc:{methods:[l.SESSION_JSONRPC.propose]},notifications:{types:[]}},ttl:l.PAIRING_DEFAULT_TTL}}(e.uri),n=t.proposer.controller!==this.controller,r=n?void 0:c.ERROR.UNAUTHORIZED_MATCHING_CONTROLLER.format({controller:this.controller}),i=yield this.pairing.respond({approved:n,proposal:t,reason:r});if(!c.isPairingResponded(i)){const e=c.ERROR.NO_MATCHING_RESPONSE.format({context:"pairing"});throw this.logger.error(e.message),new Error(e.message)}if(c.isPairingFailed(i.outcome))throw this.logger.debug("Pairing Failure"),this.logger.trace({type:"method",method:"pair",outcome:i.outcome}),new Error(i.outcome.reason.message);return this.logger.debug("Pairing Success"),this.logger.trace({type:"method",method:"pair",pending:i}),i.outcome.topic}))}approve(e){return r.__awaiter(this,void 0,void 0,(function*(){if(this.logger.debug("Approving Session Proposal"),this.logger.trace({type:"method",method:"approve",params:e}),void 0===e.response){const e=c.ERROR.MISSING_RESPONSE.format({context:"session"});throw this.logger.error(e.message),new Error(e.message)}const t=e.response.state||l.SESSION_EMPTY_STATE,n=e.response.metadata||this.metadata;if(void 0===n){const e=c.ERROR.MISSING_OR_INVALID.format({name:"app metadata"});throw this.logger.error(e.message),new Error(e.message)}const r=e.proposal.proposer.controller!==this.controller,i=r?void 0:c.ERROR.UNAUTHORIZED_MATCHING_CONTROLLER.format({controller:this.controller}),o=yield this.session.respond({approved:r,proposal:e.proposal,response:{state:t,metadata:n},reason:i});if(!c.isSessionResponded(o)){const e=c.ERROR.NO_MATCHING_RESPONSE.format({context:"session"});throw this.logger.error(e.message),new Error(e.message)}if(c.isSessionFailed(o.outcome))throw this.logger.debug("Session Proposal Approval Failure"),this.logger.trace({type:"method",method:"approve",outcome:o.outcome}),new Error(o.outcome.reason.message);return this.logger.debug("Session Proposal Approval Success"),this.logger.trace({type:"method",method:"approve",pending:o}),this.session.get(o.outcome.topic)}))}reject(e){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Rejecting Session Proposal"),this.logger.trace({type:"method",method:"reject",params:e});const t=yield this.session.respond({approved:!1,proposal:e.proposal,response:l.SESSION_EMPTY_RESPONSE,reason:e.reason});this.logger.debug("Session Proposal Response Success"),this.logger.trace({type:"method",method:"reject",pending:t})}))}upgrade(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.upgrade(e)}))}update(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.update(e)}))}request(e){return r.__awaiter(this,void 0,void 0,(function*(){return this.session.request(e)}))}respond(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.send(e.topic,e.response)}))}notify(e){return r.__awaiter(this,void 0,void 0,(function*(){yield this.session.notify(e)}))}disconnect(e){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Disconnecting Application"),this.logger.trace({type:"method",method:"disconnect",params:e}),yield this.session.delete(e)}))}onPairingRequest(e){return r.__awaiter(this,void 0,void 0,(function*(){if(e.method===l.SESSION_JSONRPC.propose){const t=e.params;if(t.proposer.controller===this.controller){const e=c.ERROR.UNAUTHORIZED_MATCHING_CONTROLLER.format({controller:this.controller});return void(yield this.session.respond({approved:!1,proposal:t,response:l.SESSION_EMPTY_RESPONSE,reason:e}))}const n=l.CLIENT_EVENTS.session.proposal;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:t}),this.events.emit(n,t)}}))}onPairingSettled(e){return r.__awaiter(this,void 0,void 0,(function*(){e.permissions.controller.publicKey===e.self.publicKey&&void 0===e.state.metadata&&(yield this.pairing.update({topic:e.topic,state:{metadata:this.metadata}}))}))}initialize(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized");try{yield this.crypto.init(),yield this.relayer.init(),yield this.pairing.init(),yield this.session.init(),this.setBeatInterval(),this.registerEventListeners(),this.logger.info("Client Initilization Success")}catch(e){throw this.logger.info("Client Initilization Failure"),this.logger.error(e),e}}))}setBeatInterval(){setInterval(()=>this.events.emit(l.CLIENT_EVENTS.beat),l.CLIENT_BEAT_INTERVAL)}registerEventListeners(){this.pairing.on(l.PAIRING_EVENTS.proposed,e=>{const t=l.CLIENT_EVENTS.pairing.proposal;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e.proposal}),this.events.emit(t,e.proposal)}),this.pairing.on(l.PAIRING_EVENTS.settled,e=>{const t=l.CLIENT_EVENTS.pairing.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e),this.onPairingSettled(e)}),this.pairing.on(l.PAIRING_EVENTS.updated,(e,t)=>{const n=l.CLIENT_EVENTS.pairing.updated;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,update:t}),this.events.emit(n,e,t)}),this.pairing.on(l.PAIRING_EVENTS.deleted,(e,t)=>{const n=l.CLIENT_EVENTS.pairing.deleted;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,reason:t}),this.events.emit(n,e,t)}),this.pairing.on(l.PAIRING_EVENTS.request,e=>{this.onPairingRequest(e.request)}),this.session.on(l.SESSION_EVENTS.proposed,e=>{const t=l.CLIENT_EVENTS.session.proposal;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e.proposal}),this.events.emit(t,e.proposal)}),this.session.on(l.SESSION_EVENTS.settled,e=>{const t=l.CLIENT_EVENTS.session.created;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(l.SESSION_EVENTS.updated,(e,t)=>{const n=l.CLIENT_EVENTS.session.updated;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,update:t}),this.events.emit(n,e,t)}),this.session.on(l.SESSION_EVENTS.deleted,(e,t)=>{const n=l.CLIENT_EVENTS.session.deleted;this.logger.info("Emitting "+n),this.logger.debug({type:"event",event:n,data:e,reason:t}),this.events.emit(n,e,t)}),this.session.on(l.SESSION_EVENTS.request,e=>{const t=l.CLIENT_EVENTS.session.request;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(l.SESSION_EVENTS.response,e=>{const t=l.CLIENT_EVENTS.session.response;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)}),this.session.on(l.SESSION_EVENTS.notification,e=>{const t=l.CLIENT_EVENTS.session.notification;this.logger.info("Emitting "+t),this.logger.debug({type:"event",event:t,data:e}),this.events.emit(t,e)})}}t.Client=h},function(e,t,n){"use strict";const r=n(73);e.exports=s;const i=function(){function e(e){return void 0!==e&&e}try{return"undefined"!=typeof globalThis||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch(t){return e(self)||e(window)||e(this)||{}}}().console||{},o={mapHttpRequest:p,mapHttpResponse:p,wrapRequestSerializer:g,wrapResponseSerializer:g,wrapErrorSerializer:g,req:p,res:p,err:function(e){const t={type:e.constructor.name,msg:e.message,stack:e.stack};for(const n in e)void 0===t[n]&&(t[n]=e[n]);return t}};function s(e){(e=e||{}).browser=e.browser||{};const t=e.browser.transmit;if(t&&"function"!=typeof t.send)throw Error("pino: transmit option must have a send function");const n=e.browser.write||i;e.browser.write&&(e.browser.asObject=!0);const r=e.serializers||{},o=function(e,t){if(Array.isArray(e)){return e.filter((function(e){return"!stdSerializers.err"!==e}))}return!0===e&&Object.keys(t)}(e.browser.serialize,r);let c=e.browser.serialize;Array.isArray(e.browser.serialize)&&e.browser.serialize.indexOf("!stdSerializers.err")>-1&&(c=!1);"function"==typeof n&&(n.error=n.fatal=n.warn=n.info=n.debug=n.trace=n),!1===e.enabled&&(e.level="silent");const l=e.level||"info",p=Object.create(n);p.log||(p.log=y),Object.defineProperty(p,"levelVal",{get:function(){return"silent"===this.level?1/0:this.levels.values[this.level]}}),Object.defineProperty(p,"level",{get:function(){return this._level},set:function(e){if("silent"!==e&&!this.levels.values[e])throw Error("unknown level "+e);this._level=e,a(g,p,"error","log"),a(g,p,"fatal","error"),a(g,p,"warn","error"),a(g,p,"info","log"),a(g,p,"debug","log"),a(g,p,"trace","log")}});const g={transmit:t,serialize:o,asObject:e.browser.asObject,levels:["error","fatal","warn","info","debug","trace"],timestamp:h(e)};return p.levels=s.levels,p.level=l,p.setMaxListeners=p.getMaxListeners=p.emit=p.addListener=p.on=p.prependListener=p.once=p.prependOnceListener=p.removeListener=p.removeAllListeners=p.listeners=p.listenerCount=p.eventNames=p.write=p.flush=y,p.serializers=r,p._serialize=o,p._stdErrSerialize=c,p.child=function(n,i){if(!n)throw new Error("missing bindings for child Pino");i=i||{},o&&n.serializers&&(i.serializers=n.serializers);const s=i.serializers;if(o&&s){var a=Object.assign({},r,s),c=!0===e.browser.serialize?Object.keys(a):o;delete n.serializers,u([n],c,a,this._stdErrSerialize)}function l(e){this._childLevel=1+(0|e._childLevel),this.error=d(e,n,"error"),this.fatal=d(e,n,"fatal"),this.warn=d(e,n,"warn"),this.info=d(e,n,"info"),this.debug=d(e,n,"debug"),this.trace=d(e,n,"trace"),a&&(this.serializers=a,this._serialize=c),t&&(this._logEvent=f([].concat(e._logEvent.bindings,n)))}return l.prototype=this,new l(this)},t&&(p._logEvent=f()),p}function a(e,t,n,r){const o=Object.getPrototypeOf(t);t[n]=t.levelVal>t.levels.values[n]?y:o[n]?o[n]:i[n]||i[r]||y,function(e,t,n){if(!e.transmit&&t[n]===y)return;t[n]=(r=t[n],function(){const o=e.timestamp(),a=new Array(arguments.length),d=Object.getPrototypeOf&&Object.getPrototypeOf(this)===i?i:this;for(var f=0;f<a.length;f++)a[f]=arguments[f];if(e.serialize&&!e.asObject&&u(a,this._serialize,this.serializers,this._stdErrSerialize),e.asObject?r.call(d,c(this,n,a,o)):r.apply(d,a),e.transmit){const r=e.transmit.level||t.level,i=s.levels.values[r],c=s.levels.values[n];if(c<i)return;l(this,{ts:o,methodLevel:n,methodValue:c,transmitLevel:r,transmitValue:s.levels.values[e.transmit.level||t.level],send:e.transmit.send,val:t.levelVal},a)}});var r}(e,t,n)}function c(e,t,n,i){e._serialize&&u(n,e._serialize,e.serializers,e._stdErrSerialize);const o=n.slice();let a=o[0];const c={};i&&(c.time=i),c.level=s.levels.values[t];let d=1+(0|e._childLevel);if(d<1&&(d=1),null!==a&&"object"==typeof a){for(;d--&&"object"==typeof o[0];)Object.assign(c,o.shift());a=o.length?r(o.shift(),o):void 0}else"string"==typeof a&&(a=r(o.shift(),o));return void 0!==a&&(c.msg=a),c}function u(e,t,n,r){for(const i in e)if(r&&e[i]instanceof Error)e[i]=s.stdSerializers.err(e[i]);else if("object"==typeof e[i]&&!Array.isArray(e[i]))for(const r in e[i])t&&t.indexOf(r)>-1&&r in n&&(e[i][r]=n[r](e[i][r]))}function d(e,t,n){return function(){const r=new Array(1+arguments.length);r[0]=t;for(var i=1;i<r.length;i++)r[i]=arguments[i-1];return e[n].apply(this,r)}}function l(e,t,n){const r=t.send,i=t.ts,o=t.methodLevel,s=t.methodValue,a=t.val,c=e._logEvent.bindings;u(n,e._serialize||Object.keys(e.serializers),e.serializers,void 0===e._stdErrSerialize||e._stdErrSerialize),e._logEvent.ts=i,e._logEvent.messages=n.filter((function(e){return-1===c.indexOf(e)})),e._logEvent.level.label=o,e._logEvent.level.value=s,r(o,e._logEvent,a),e._logEvent=f(c)}function f(e){return{ts:0,messages:[],bindings:e||[],level:{label:"",value:0}}}function h(e){return"function"==typeof e.timestamp?e.timestamp:!1===e.timestamp?E:_}function p(){return{}}function g(e){return e}function y(){}function E(){return!1}function _(){return Date.now()}s.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},s.stdSerializers=o,s.stdTimeFunctions=Object.assign({},{nullTime:E,epochTime:_,unixTime:function(){return Math.round(Date.now()/1e3)},isoTime:function(){return new Date(Date.now()).toISOString()}})},function(e,t,n){"use strict";function r(e){try{return JSON.stringify(e)}catch(e){return'"[Circular]"'}}e.exports=function(e,t,n){var i=n&&n.stringify||r;if("object"==typeof e&&null!==e){var o=t.length+1;if(1===o)return e;var s=new Array(o);s[0]=i(e);for(var a=1;a<o;a++)s[a]=i(t[a]);return s.join(" ")}if("string"!=typeof e)return e;var c=t.length;if(0===c)return e;for(var u="",d=0,l=-1,f=e&&e.length||0,h=0;h<f;){if(37===e.charCodeAt(h)&&h+1<f){switch(l=l>-1?l:0,e.charCodeAt(h+1)){case 100:case 102:if(d>=c)break;if(l<h&&(u+=e.slice(l,h)),null==t[d])break;u+=Number(t[d]),l=h+=2;break;case 105:if(d>=c)break;if(l<h&&(u+=e.slice(l,h)),null==t[d])break;u+=Math.floor(Number(t[d])),l=h+=2;break;case 79:case 111:case 106:if(d>=c)break;if(l<h&&(u+=e.slice(l,h)),void 0===t[d])break;var p=typeof t[d];if("string"===p){u+="'"+t[d]+"'",l=h+2,h++;break}if("function"===p){u+=t[d].name||"<anonymous>",l=h+2,h++;break}u+=i(t[d]),l=h+2,h++;break;case 115:if(d>=c)break;l<h&&(u+=e.slice(l,h)),u+=String(t[d]),l=h+2,h++;break;case 37:l<h&&(u+=e.slice(l,h)),u+="%",l=h+2,h++,d--}++d}++h}if(-1===l)return e;l<f&&(u+=e.slice(l));return u}},function(e,t,n){"use strict";var r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))},i=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0});const o=i(n(75)),s=n(32),a=n(76);class c{constructor(){this.localStorage=o.default}getKeys(){return r(this,void 0,void 0,(function*(){return Object.keys(this.localStorage)}))}getEntries(){return r(this,void 0,void 0,(function*(){return Object.entries(this.localStorage).map(a.parseEntry)}))}getItem(e){return r(this,void 0,void 0,(function*(){const t=this.localStorage.getItem(e);if(null!==t)return s.safeJsonParse(t)}))}setItem(e,t){return r(this,void 0,void 0,(function*(){this.localStorage.setItem(e,s.safeJsonStringify(t))}))}removeItem(e){return r(this,void 0,void 0,(function*(){this.localStorage.removeItem(e)}))}}t.KeyValueStorage=c,t.default=c},function(e,t,n){(function(t){!function(){"use strict";var n;function r(){}(n=r).prototype.getItem=function(e){return this.hasOwnProperty(e)?String(this[e]):null},n.prototype.setItem=function(e,t){this[e]=String(t)},n.prototype.removeItem=function(e){delete this[e]},n.prototype.clear=function(){var e=this;Object.keys(e).forEach((function(t){e[t]=void 0,delete e[t]}))},n.prototype.key=function(e){return e=e||0,Object.keys(this)[e]},n.prototype.__defineGetter__("length",(function(){return Object.keys(this).length})),t.localStorage?e.exports=localStorage:e.exports=new r}()}).call(this,n(27))},function(e,t,n){"use strict";function r(e){for(var n in e)t.hasOwnProperty(n)||(t[n]=e[n])}Object.defineProperty(t,"__esModule",{value:!0}),r(n(77)),r(n(79))},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(78);t.IKeyValueStorage=r.IKeyValueStorage},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.IKeyValueStorage=class{}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(32);function i(e){return t.REACT_NATIVE_REQUIRED_OPTION in e}function o(e){return t.NODE_JS_REQUIRED_OPTION in e}t.REACT_NATIVE_REQUIRED_OPTION="asyncStorage",t.isReactNativeOptions=i,t.getReactNativeOptions=function(e){if(void 0===e||!i(e))throw new Error(`Missing ${t.REACT_NATIVE_REQUIRED_OPTION} option required for React-Native`);return e},t.NODE_JS_REQUIRED_OPTION="database",t.isNodeJSOptions=o,t.getNodeJSOptions=function(e){if(void 0===e||!o(e))throw new Error(`Missing ${t.NODE_JS_REQUIRED_OPTION} option required for NodeJS`);return e},t.parseEntry=function(e){return[e[0],r.safeJsonParse(e[1])]}},function(e,t,n){"use strict";(function(e){function n(){return(null==e?void 0:e.crypto)||(null==e?void 0:e.msCrypto)||{}}function r(){const e=n();return e.subtle||e.webkitSubtle}Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowserCryptoAvailable=t.getSubtleCrypto=t.getBrowerCrypto=void 0,t.getBrowerCrypto=n,t.getSubtleCrypto=r,t.isBrowserCryptoAvailable=function(){return!!n()&&!!r()}}).call(this,n(27))},function(e,t,n){"use strict";(function(e){function n(){return"undefined"==typeof document&&"undefined"!=typeof navigator&&"ReactNative"===navigator.product}function r(){return void 0!==e&&void 0!==e.versions&&void 0!==e.versions.node}Object.defineProperty(t,"__esModule",{value:!0}),t.isBrowser=t.isNode=t.isReactNative=void 0,t.isReactNative=n,t.isNode=r,t.isBrowser=function(){return!n()&&!r()}}).call(this,n(46))},function(e,t,n){"use strict";t.byteLength=function(e){var t=u(e),n=t[0],r=t[1];return 3*(n+r)/4-r},t.toByteArray=function(e){var t,n,r=u(e),s=r[0],a=r[1],c=new o(function(e,t,n){return 3*(t+n)/4-n}(0,s,a)),d=0,l=a>0?s-4:s;for(n=0;n<l;n+=4)t=i[e.charCodeAt(n)]<<18|i[e.charCodeAt(n+1)]<<12|i[e.charCodeAt(n+2)]<<6|i[e.charCodeAt(n+3)],c[d++]=t>>16&255,c[d++]=t>>8&255,c[d++]=255&t;2===a&&(t=i[e.charCodeAt(n)]<<2|i[e.charCodeAt(n+1)]>>4,c[d++]=255&t);1===a&&(t=i[e.charCodeAt(n)]<<10|i[e.charCodeAt(n+1)]<<4|i[e.charCodeAt(n+2)]>>2,c[d++]=t>>8&255,c[d++]=255&t);return c},t.fromByteArray=function(e){for(var t,n=e.length,i=n%3,o=[],s=0,a=n-i;s<a;s+=16383)o.push(d(e,s,s+16383>a?a:s+16383));1===i?(t=e[n-1],o.push(r[t>>2]+r[t<<4&63]+"==")):2===i&&(t=(e[n-2]<<8)+e[n-1],o.push(r[t>>10]+r[t>>4&63]+r[t<<2&63]+"="));return o.join("")};for(var r=[],i=[],o="undefined"!=typeof Uint8Array?Uint8Array:Array,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",a=0,c=s.length;a<c;++a)r[a]=s[a],i[s.charCodeAt(a)]=a;function u(e){var t=e.length;if(t%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var n=e.indexOf("=");return-1===n&&(n=t),[n,n===t?0:4-n%4]}function d(e,t,n){for(var i,o,s=[],a=t;a<n;a+=3)i=(e[a]<<16&16711680)+(e[a+1]<<8&65280)+(255&e[a+2]),s.push(r[(o=i)>>18&63]+r[o>>12&63]+r[o>>6&63]+r[63&o]);return s.join("")}i["-".charCodeAt(0)]=62,i["_".charCodeAt(0)]=63},function(e,t){
/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */
t.read=function(e,t,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,u=c>>1,d=-7,l=n?i-1:0,f=n?-1:1,h=e[t+l];for(l+=f,o=h&(1<<-d)-1,h>>=-d,d+=a;d>0;o=256*o+e[t+l],l+=f,d-=8);for(s=o&(1<<-d)-1,o>>=-d,d+=r;d>0;s=256*s+e[t+l],l+=f,d-=8);if(0===o)o=1-u;else{if(o===c)return s?NaN:1/0*(h?-1:1);s+=Math.pow(2,r),o-=u}return(h?-1:1)*s*Math.pow(2,o-r)},t.write=function(e,t,n,r,i,o){var s,a,c,u=8*o-i-1,d=(1<<u)-1,l=d>>1,f=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=r?0:o-1,p=r?1:-1,g=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(a=isNaN(t)?1:0,s=d):(s=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-s))<1&&(s--,c*=2),(t+=s+l>=1?f/c:f*Math.pow(2,1-l))*c>=2&&(s++,c/=2),s+l>=d?(a=0,s=d):s+l>=1?(a=(t*c-1)*Math.pow(2,i),s+=l):(a=t*Math.pow(2,l-1)*Math.pow(2,i),s=0));i>=8;e[n+h]=255&a,h+=p,a/=256,i-=8);for(s=s<<i|a,u+=i;u>0;e[n+h]=255&s,h+=p,s/=256,u-=8);e[n+h-p]|=128*g}},function(e,t){var n={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==n.call(e)}},function(e,t,n){(function(t){var r=n(56).strict;e.exports=function(e){if(r(e)){var n=t.from(e.buffer);return e.byteLength!==e.buffer.byteLength&&(n=n.slice(e.byteOffset,e.byteOffset+e.byteLength)),n}return t.from(e)}}).call(this,n(55).Buffer)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(87),i=n(91),o=n(29);function s(e,n){return void 0===n&&(n=t.defaultRandomSource),n.randomBytes(e)}t.defaultRandomSource=new r.SystemRandomSource,t.randomBytes=s,t.randomUint32=function(e){void 0===e&&(e=t.defaultRandomSource);var n=s(4,e),r=i.readUint32LE(n);return o.wipe(n),r};var a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(e,n,r){if(void 0===n&&(n=a),void 0===r&&(r=t.defaultRandomSource),n.length<2)throw new Error("randomString charset is too short");if(n.length>256)throw new Error("randomString charset is too long");for(var i="",c=n.length,u=256-256%c;e>0;){for(var d=s(Math.ceil(256*e/u),r),l=0;l<d.length&&e>0;l++){var f=d[l];f<u&&(i+=n.charAt(f%c),e--)}o.wipe(d)}return i}t.randomString=c,t.randomStringForEntropy=function(e,n,r){return void 0===n&&(n=a),void 0===r&&(r=t.defaultRandomSource),c(Math.ceil(e/(Math.log(n.length)/Math.LN2)),n,r)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(88),i=n(89),o=function(){function e(){return this.isAvailable=!1,this.name="",this._source=new r.BrowserRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Browser")):(this._source=new i.NodeRandomSource,this._source.isAvailable?(this.isAvailable=!0,void(this.name="Node")):void 0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)},e}();t.SystemRandomSource=o},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(){this.isAvailable=!1,this.isInstantiated=!1;var e="undefined"!=typeof self?self.crypto||self.msCrypto:null;e&&e.getRandomValues&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");for(var t=new Uint8Array(e),n=0;n<t.length;n+=65536)this._crypto.getRandomValues(t.subarray(n,n+Math.min(t.length-n,65536)));return t},e}();t.BrowserRandomSource=r},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(29),i=function(){function e(){this.isAvailable=!1,this.isInstantiated=!1;var e=n(90);e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}return e.prototype.randomBytes=function(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");var t=this._crypto.randomBytes(e);if(t.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");for(var n=new Uint8Array(e),i=0;i<n.length;i++)n[i]=t[i];return r.wipe(t),n},e}();t.NodeRandomSource=i},function(e,t){},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=n(92);function i(e,t,n){return void 0===t&&(t=new Uint8Array(2)),void 0===n&&(n=0),t[n+0]=e>>>8,t[n+1]=e>>>0,t}function o(e,t,n){return void 0===t&&(t=new Uint8Array(2)),void 0===n&&(n=0),t[n+0]=e>>>0,t[n+1]=e>>>8,t}function s(e,t){return void 0===t&&(t=0),e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3]}function a(e,t){return void 0===t&&(t=0),(e[t]<<24|e[t+1]<<16|e[t+2]<<8|e[t+3])>>>0}function c(e,t){return void 0===t&&(t=0),e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t]}function u(e,t){return void 0===t&&(t=0),(e[t+3]<<24|e[t+2]<<16|e[t+1]<<8|e[t])>>>0}function d(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),t[n+0]=e>>>24,t[n+1]=e>>>16,t[n+2]=e>>>8,t[n+3]=e>>>0,t}function l(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),t[n+0]=e>>>0,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24,t}function f(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),d(e/4294967296>>>0,t,n),d(e>>>0,t,n+4),t}function h(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),l(e>>>0,t,n),l(e/4294967296>>>0,t,n+4),t}t.readInt16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])<<16>>16},t.readUint16BE=function(e,t){return void 0===t&&(t=0),(e[t+0]<<8|e[t+1])>>>0},t.readInt16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])<<16>>16},t.readUint16LE=function(e,t){return void 0===t&&(t=0),(e[t+1]<<8|e[t])>>>0},t.writeUint16BE=i,t.writeInt16BE=i,t.writeUint16LE=o,t.writeInt16LE=o,t.readInt32BE=s,t.readUint32BE=a,t.readInt32LE=c,t.readUint32LE=u,t.writeUint32BE=d,t.writeInt32BE=d,t.writeUint32LE=l,t.writeInt32LE=l,t.readInt64BE=function(e,t){void 0===t&&(t=0);var n=s(e,t),r=s(e,t+4);return 4294967296*n+r-4294967296*(r>>31)},t.readUint64BE=function(e,t){return void 0===t&&(t=0),4294967296*a(e,t)+a(e,t+4)},t.readInt64LE=function(e,t){void 0===t&&(t=0);var n=c(e,t);return 4294967296*c(e,t+4)+n-4294967296*(n>>31)},t.readUint64LE=function(e,t){void 0===t&&(t=0);var n=u(e,t);return 4294967296*u(e,t+4)+n},t.writeUint64BE=f,t.writeInt64BE=f,t.writeUint64LE=h,t.writeInt64LE=h,t.readUintBE=function(e,t,n){if(void 0===n&&(n=0),e%8!=0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(e/8>t.length-n)throw new Error("readUintBE: array is too short for the given bitLength");for(var r=0,i=1,o=e/8+n-1;o>=n;o--)r+=t[o]*i,i*=256;return r},t.readUintLE=function(e,t,n){if(void 0===n&&(n=0),e%8!=0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(e/8>t.length-n)throw new Error("readUintLE: array is too short for the given bitLength");for(var r=0,i=1,o=n;o<n+e/8;o++)r+=t[o]*i,i*=256;return r},t.writeUintBE=function(e,t,n,i){if(void 0===n&&(n=new Uint8Array(e/8)),void 0===i&&(i=0),e%8!=0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!r.isSafeInteger(t))throw new Error("writeUintBE value must be an integer");for(var o=1,s=e/8+i-1;s>=i;s--)n[s]=t/o&255,o*=256;return n},t.writeUintLE=function(e,t,n,i){if(void 0===n&&(n=new Uint8Array(e/8)),void 0===i&&(i=0),e%8!=0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!r.isSafeInteger(t))throw new Error("writeUintLE value must be an integer");for(var o=1,s=i;s<i+e/8;s++)n[s]=t/o&255,o*=256;return n},t.readFloat32BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t)},t.readFloat32LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat32(t,!0)},t.readFloat64BE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t)},t.readFloat64LE=function(e,t){return void 0===t&&(t=0),new DataView(e.buffer,e.byteOffset,e.byteLength).getFloat64(t,!0)},t.writeFloat32BE=function(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e),t},t.writeFloat32LE=function(e,t,n){return void 0===t&&(t=new Uint8Array(4)),void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat32(n,e,!0),t},t.writeFloat64BE=function(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e),t},t.writeFloat64LE=function(e,t,n){return void 0===t&&(t=new Uint8Array(8)),void 0===n&&(n=0),new DataView(t.buffer,t.byteOffset,t.byteLength).setFloat64(n,e,!0),t}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.mul=Math.imul||function(e,t){var n=65535&e,r=65535&t;return n*r+((e>>>16&65535)*r+n*(t>>>16&65535)<<16>>>0)|0},t.add=function(e,t){return e+t|0},t.sub=function(e,t){return e-t|0},t.rotl=function(e,t){return e<<t|e>>>32-t},t.rotr=function(e,t){return e<<32-t|e>>>t},t.isInteger=Number.isInteger||function(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e},t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(e){return t.isInteger(e)&&e>=-t.MAX_SAFE_INTEGER&&e<=t.MAX_SAFE_INTEGER}},function(e,t,n){"use strict";e.exports=e=>encodeURIComponent(e).replace(/[!'()*]/g,e=>"%"+e.charCodeAt(0).toString(16).toUpperCase())},function(e,t,n){"use strict";var r=new RegExp("%[a-f0-9]{2}","gi"),i=new RegExp("(%[a-f0-9]{2})+","gi");function o(e,t){try{return decodeURIComponent(e.join(""))}catch(e){}if(1===e.length)return e;t=t||1;var n=e.slice(0,t),r=e.slice(t);return Array.prototype.concat.call([],o(n),o(r))}function s(e){try{return decodeURIComponent(e)}catch(i){for(var t=e.match(r),n=1;n<t.length;n++)t=(e=o(t,n).join("")).match(r);return e}}e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof e+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return function(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},n=i.exec(e);n;){try{t[n[0]]=decodeURIComponent(n[0])}catch(e){var r=s(n[0]);r!==n[0]&&(t[n[0]]=r)}n=i.exec(e)}t["%C2"]="�";for(var o=Object.keys(t),a=0;a<o.length;a++){var c=o[a];e=e.replace(new RegExp(c,"g"),t[c])}return e}(e)}}},function(e,t,n){"use strict";e.exports=(e,t)=>{if("string"!=typeof e||"string"!=typeof t)throw new TypeError("Expected the arguments to be of type `string`");if(""===t)return[e];const n=e.indexOf(t);return-1===n?[e]:[e.slice(0,n),e.slice(n+t.length)]}},function(e,t,n){"use strict";e.exports=function(e,t){for(var n={},r=Object.keys(e),i=Array.isArray(t),o=0;o<r.length;o++){var s=r[o],a=e[s];(i?-1!==t.indexOf(s):t(s,a,e))&&(n[s]=a)}return n}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.generateChildLogger=t.formatChildLoggerContext=t.getLoggerContext=t.setBrowserLoggerContext=t.getBrowserLoggerContext=t.getDefaultLoggerOptions=void 0;const r=n(57);function i(e,t=r.PINO_CUSTOM_CONTEXT_KEY){return e[t]||""}function o(e,t,n=r.PINO_CUSTOM_CONTEXT_KEY){return e[n]=t,e}function s(e,t=r.PINO_CUSTOM_CONTEXT_KEY){let n="";return n=void 0===e.bindings?i(e,t):e.bindings().context||"",n}function a(e,t,n=r.PINO_CUSTOM_CONTEXT_KEY){const i=s(e,n);return i.trim()?`${i}/${t}`:t}t.getDefaultLoggerOptions=function(e){return Object.assign(Object.assign({},e),{level:(null==e?void 0:e.level)||r.PINO_LOGGER_DEFAULTS.level,prettyPrint:(null==e?void 0:e.prettyPrint)||r.PINO_LOGGER_DEFAULTS.prettyPrint})},t.getBrowserLoggerContext=i,t.setBrowserLoggerContext=o,t.getLoggerContext=s,t.formatChildLoggerContext=a,t.generateChildLogger=function(e,t,n=r.PINO_CUSTOM_CONTEXT_KEY){const i=a(e,t,n);return o(e.child({context:i}),i,n)}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});const r=n(8);r.__exportStar(n(99),t),r.__exportStar(n(107),t),r.__exportStar(n(111),t),r.__exportStar(n(30),t)},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Pairing=void 0;const r=n(8),i=n(12),o=n(20),s=n(16),a=n(15),c=n(30),u=n(58),d=n(65),l=n(14);class f extends s.IPairing{constructor(e,t){super(e,t),this.client=e,this.logger=t,this.events=new i.EventEmitter,this.context=l.PAIRING_CONTEXT,this.config={status:l.PAIRING_STATUS,events:l.PAIRING_EVENTS,jsonrpc:l.PAIRING_JSONRPC},this.logger=o.generateChildLogger(t,this.context),this.pending=new c.Subscription(e,this.logger,this.config.status.pending),this.settled=new c.Subscription(e,this.logger,this.config.status.settled),this.history=new u.JsonRpcHistory(e,this.logger),this.engine=new d.Engine(this)}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.pending.init(),yield this.settled.init(),yield this.history.init()}))}get(e){return this.settled.get(e)}find(e){return this.engine.find(e)}ping(e,t){return this.engine.ping(e,t)}send(e,t){return this.engine.send(e,t)}get length(){return this.settled.length}get topics(){return this.settled.topics}get values(){return this.settled.values.map(e=>e.data)}create(e){return this.engine.create(e)}respond(e){return this.engine.respond(e)}upgrade(e){return this.engine.upgrade(e)}update(e){return this.engine.update(e)}request(e){return this.engine.request(e)}delete(e){return this.engine.delete(e)}notify(e){return this.engine.notify(e)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}mergeUpdate(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=yield this.settled.get(e);return{metadata:t.state.metadata||n.state.metadata}}))}mergeUpgrade(e,t){var n,i,o;return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.settled.get(e);return{jsonrpc:{methods:[...r.permissions.jsonrpc.methods,...(null===(n=t.permissions.jsonrpc)||void 0===n?void 0:n.methods)||[]]},notifications:{types:[...null===(i=r.permissions.notifications)||void 0===i?void 0:i.types,...(null===(o=t.permissions.notifications)||void 0===o?void 0:o.types)||[]]},controller:r.permissions.controller}}))}validateRespond(e){return r.__awaiter(this,void 0,void 0,(function*(){}))}validateRequest(e){return r.__awaiter(this,void 0,void 0,(function*(){}))}validatePropose(e){return r.__awaiter(this,void 0,void 0,(function*(){}))}getDefaultSignal({topic:e,relay:t,proposer:n}){return r.__awaiter(this,void 0,void 0,(function*(){const r=a.formatUri({protocol:this.client.protocol,version:this.client.version,topic:e,publicKey:n.publicKey,controller:n.controller,relay:t});return{method:l.PAIRING_SIGNAL_METHOD_URI,params:{uri:r}}}))}getDefaultTTL(){return r.__awaiter(this,void 0,void 0,(function*(){return l.PAIRING_DEFAULT_TTL}))}getDefaultPermissions(){return r.__awaiter(this,void 0,void 0,(function*(){return{jsonrpc:{methods:[l.SESSION_JSONRPC.propose]},notifications:{types:[]}}}))}}t.Pairing=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CLIENT_STORAGE_OPTIONS=t.CLIENT_EVENTS=t.CLIENT_BEAT_INTERVAL=t.CLIENT_CONTEXT=void 0;const r=n(21);t.CLIENT_CONTEXT="client",t.CLIENT_BEAT_INTERVAL=1e3*r.FIVE_SECONDS,t.CLIENT_EVENTS={beat:"client_beat",pairing:{proposal:"pairing_proposal",updated:"pairing_updated",created:"pairing_created",deleted:"pairing_deleted"},session:{proposal:"session_proposal",updated:"session_updated",created:"session_created",deleted:"session_deleted",notification:"session_notification",request:"session_request",response:"session_response"}},t.CLIENT_STORAGE_OPTIONS={database:":memory:"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.KEYCHAIN_CONTEXT=t.CRYPTO_CONTEXT=void 0,t.CRYPTO_CONTEXT="crypto",t.KEYCHAIN_CONTEXT="keychain"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HISTORY_CONTEXT=t.HISTORY_EVENTS=void 0,t.HISTORY_EVENTS={created:"history_created",updated:"history_updated",deleted:"history_deleted",enabled:"history_enabled",disabled:"history_disabled",sync:"history_sync"},t.HISTORY_CONTEXT="history"},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.PAIRING_EVENTS=t.PAIRING_STATUS=t.PAIRING_SIGNAL_METHOD_URI=t.PAIRING_DEFAULT_TTL=t.PAIRING_CONTEXT=t.PAIRING_JSONRPC=void 0;const r=n(21);t.PAIRING_JSONRPC={propose:"wc_pairingPropose",approve:"wc_pairingApprove",reject:"wc_pairingReject",update:"wc_pairingUpdate",upgrade:"wc_pairingUpgrade",delete:"wc_pairingDelete",payload:"wc_pairingPayload",ping:"wc_pairingPing",notification:"wc_pairingNotification"},t.PAIRING_CONTEXT="pairing",t.PAIRING_DEFAULT_TTL=r.THIRTY_DAYS,t.PAIRING_SIGNAL_METHOD_URI="uri",t.PAIRING_STATUS={proposed:"proposed",responded:"responded",pending:"pending",settled:"settled"},t.PAIRING_EVENTS={proposed:"pairing_proposed",responded:"pairing_responded",settled:"pairing_settled",updated:"pairing_updated",deleted:"pairing_deleted",request:"pairing_request",response:"pairing_response",enabled:"pairing_enabled",disabled:"pairing_disabled",sync:"pairing_sync",notification:"pairing_notification"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RELAYER_EVENTS=t.RELAYER_CONTEXT=t.RELAYER_DEFAULT_RPC_URL=t.RELAYER_DEFAULT_PROTOCOL=t.RELAYER_DEFAULT_PUBLISH_TTL=void 0;const r=n(21);t.RELAYER_DEFAULT_PUBLISH_TTL=r.SIX_HOURS,t.RELAYER_DEFAULT_PROTOCOL="waku",t.RELAYER_DEFAULT_RPC_URL="wss://relay.walletconnect.org",t.RELAYER_CONTEXT="relayer",t.RELAYER_EVENTS={connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error"}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SESSION_EMPTY_RESPONSE=t.SESSION_EMPTY_METADATA=t.SESSION_EMPTY_STATE=t.SESSION_EMPTY_PERMISSIONS=t.SESSION_EVENTS=t.SESSION_STATUS=t.SESSION_SIGNAL_METHOD_PAIRING=t.SESSION_DEFAULT_TTL=t.SESSION_CONTEXT=t.SESSION_JSONRPC=void 0;const r=n(21);t.SESSION_JSONRPC={propose:"wc_sessionPropose",approve:"wc_sessionApprove",reject:"wc_sessionReject",update:"wc_sessionUpdate",upgrade:"wc_sessionUpgrade",delete:"wc_sessionDelete",payload:"wc_sessionPayload",ping:"wc_sessionPing",notification:"wc_sessionNotification"},t.SESSION_CONTEXT="session",t.SESSION_DEFAULT_TTL=r.SEVEN_DAYS,t.SESSION_SIGNAL_METHOD_PAIRING="pairing",t.SESSION_STATUS={proposed:"proposed",responded:"responded",pending:"pending",settled:"settled"},t.SESSION_EVENTS={proposed:"session_proposed",responded:"session_responded",settled:"session_settled",updated:"session_updated",deleted:"session_deleted",request:"session_request",response:"session_response",enabled:"session_enabled",disabled:"session_disabled",sync:"session_sync",notification:"session_notification"},t.SESSION_EMPTY_PERMISSIONS={jsonrpc:{methods:[]},blockchain:{chains:[]},notifications:{types:[]}},t.SESSION_EMPTY_STATE={accounts:[]},t.SESSION_EMPTY_METADATA={name:"",description:"",url:"",icons:[]},t.SESSION_EMPTY_RESPONSE={metadata:t.SESSION_EMPTY_METADATA,state:t.SESSION_EMPTY_STATE}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SUBSCRIPTION_DEFAULT_TTL=t.SUBSCRIPTION_EVENTS=void 0;const r=n(21);t.SUBSCRIPTION_EVENTS={payload:"subscription_payload",created:"subscription_created",updated:"subscription_updated",deleted:"subscription_deleted",enabled:"subscription_enabled",disabled:"subscription_disabled",sync:"subscription_sync"},t.SUBSCRIPTION_DEFAULT_TTL=r.THIRTY_DAYS},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Relayer=void 0;const r=n(8),i=n(12),o=n(20),s=n(16),a=n(108),c=n(15),u=r.__importStar(n(1)),d=n(6),l=n(113),f=n(109),h=n(17),p=n(14);class g extends s.IRelayer{constructor(e,t,n){super(e,t),this.client=e,this.logger=t,this.events=new i.EventEmitter,this.context=p.RELAYER_CONTEXT,this.logger=o.generateChildLogger(t,this.context),this.provider=this.setProvider(n),this.registerEventListeners()}get connected(){return this.provider.connection.connected}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.provider.connect()}))}publish(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:e,payload:t,opts:n}});try{const r=(null==n?void 0:n.relay.protocol)||p.RELAYER_DEFAULT_PROTOCOL,i=h.safeJsonStringify(t),o=(yield this.client.crypto.hasKeys(e))?yield this.client.crypto.encrypt(e,i):u.utf8ToHex(i),s={method:y(r).publish,params:{topic:e,message:o,ttl:(null==n?void 0:n.ttl)||p.RELAYER_DEFAULT_PUBLISH_TTL}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:s}),yield this.provider.request(s),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",request:s})}catch(e){throw this.logger.debug("Failed to Publish Payload"),this.logger.error(e),e}}))}subscribe(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:e,opts:n}});try{const i=(null==n?void 0:n.relay.protocol)||p.RELAYER_DEFAULT_PROTOCOL,o={method:y(i).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:o});const s=yield this.provider.request(o);return this.events.on(s,({message:n})=>r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.client.crypto.hasKeys(e),i=h.safeJsonParse(r?yield this.client.crypto.decrypt(e,n):u.hexToUtf8(n));t(i)}))),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",request:o}),s}catch(e){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(e),e}}))}unsubscribe(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{id:t,opts:n}});try{const r=(null==n?void 0:n.relay.protocol)||p.RELAYER_DEFAULT_PROTOCOL,i={method:y(r).unsubscribe,params:{topic:e,id:t}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i}),yield this.provider.request(i),this.events.removeAllListeners(t),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",request:i})}catch(e){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(e),e}}))}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}onPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),d.isJsonRpcRequest(e)&&e.method.endsWith("_subscription")){const t=e.params;this.events.emit(t.id,t.data);const n=d.formatJsonRpcResult(e.id,!0);this.provider.connection.send(n)}}setProvider(e){this.logger.debug("Setting Relay Provider"),this.logger.trace({type:"method",method:"setProvider",provider:null==e?void 0:e.toString()});const t=c.formatRelayRpcUrl(this.client.protocol,this.client.version,"string"==typeof e?e:p.RELAYER_DEFAULT_RPC_URL);return"string"!=typeof e&&void 0!==e?e:new l.JsonRpcProvider(new f.WsConnection(t))}registerEventListeners(){this.provider.on("payload",e=>this.onPayload(e)),this.provider.on("connect",()=>this.events.emit(p.RELAYER_EVENTS.connect)),this.provider.on("disconnect",()=>{this.events.emit(p.RELAYER_EVENTS.disconnect),this.provider.connect()}),this.provider.on("error",e=>this.events.emit(p.RELAYER_EVENTS.error,e))}}function y(e){const t=a.RELAY_JSONRPC[e];if(void 0===t)throw new Error("Relay Protocol not supported: "+e);return t}t.Relayer=g},function(e,t,n){"use strict";n.r(t);var r=n(66);for(var i in r)["default"].indexOf(i)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(i);var o=n(67);n.d(t,"parseSubscribeRequest",(function(){return o.b})),n.d(t,"parsePublishRequest",(function(){return o.a})),n.d(t,"parseUnsubscribeRequest",(function(){return o.d})),n.d(t,"parseSubscriptionRequest",(function(){return o.c}));var s=n(68);n.d(t,"RELAY_JSONRPC",(function(){return s.a}));var a=n(11);n.d(t,"isSubscribeRequest",(function(){return a.f})),n.d(t,"isSubscribeMethod",(function(){return a.d})),n.d(t,"isSubscribeParams",(function(){return a.e})),n.d(t,"isPublishRequest",(function(){return a.c})),n.d(t,"isPublishMethod",(function(){return a.a})),n.d(t,"isPublishParams",(function(){return a.b})),n.d(t,"isUnsubscribeRequest",(function(){return a.l})),n.d(t,"isUnsubscribeMethod",(function(){return a.j})),n.d(t,"isUnsubscribeParams",(function(){return a.k})),n.d(t,"isSubscriptionRequest",(function(){return a.i})),n.d(t,"isSubscriptionMethod",(function(){return a.g})),n.d(t,"isSubscriptionParams",(function(){return a.h}))},function(e,t,n){"use strict";n.r(t);var r=n(28);n.d(t,"WsConnection",(function(){return r.a})),t.default=r.b},function(e,t,n){"use strict";e.exports=function(){throw new Error("ws does not work in the browser. Browser clients must use the native WebSocket object")}},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Session=void 0;const r=n(8),i=n(12),o=n(20),s=n(16),a=n(15),c=n(30),u=n(58),d=n(14),l=n(65);class f extends s.ISession{constructor(e,t){super(e,t),this.client=e,this.logger=t,this.events=new i.EventEmitter,this.context=d.SESSION_CONTEXT,this.config={status:d.SESSION_STATUS,events:d.SESSION_EVENTS,jsonrpc:d.SESSION_JSONRPC},this.logger=o.generateChildLogger(t,this.context),this.pending=new c.Subscription(e,this.logger,this.config.status.pending),this.settled=new c.Subscription(e,this.logger,this.config.status.settled),this.history=new u.JsonRpcHistory(e,this.logger),this.engine=new l.Engine(this)}init(){return r.__awaiter(this,void 0,void 0,(function*(){this.logger.trace("Initialized"),yield this.pending.init(),yield this.settled.init(),yield this.history.init()}))}get(e){return this.settled.get(e)}find(e){return this.engine.find(e)}ping(e,t){return this.engine.ping(e,t)}send(e,t,n){return this.engine.send(e,t,n)}get length(){return this.settled.length}get topics(){return this.settled.topics}get values(){return this.settled.values.map(e=>e.data)}create(e){return this.engine.create(e)}respond(e){return this.engine.respond(e)}upgrade(e){return this.engine.upgrade(e)}update(e){return this.engine.update(e)}request(e){return this.engine.request(e)}delete(e){return this.engine.delete(e)}notify(e){return this.engine.notify(e)}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}mergeUpdate(e,t){var n;return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.settled.get(e);return{accounts:(null===(n=t.state)||void 0===n?void 0:n.accounts)||r.state.accounts}}))}mergeUpgrade(e,t){var n,i,o,s,a;return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.settled.get(e);return{jsonrpc:{methods:[...r.permissions.jsonrpc.methods,...(null===(n=t.permissions.jsonrpc)||void 0===n?void 0:n.methods)||[]]},notifications:{types:[...null===(i=r.permissions.notifications)||void 0===i?void 0:i.types,...(null===(o=t.permissions.notifications)||void 0===o?void 0:o.types)||[]]},blockchain:{chains:[...null===(s=r.permissions.blockchain)||void 0===s?void 0:s.chains,...(null===(a=t.permissions.blockchain)||void 0===a?void 0:a.chains)||[]]},controller:r.permissions.controller}}))}validateRespond(e){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===e){const e=a.ERROR.MISSING_OR_INVALID.format({name:"respond params"});throw this.logger.error(e.message),new Error(e.message)}const t=a.validateSessionRespondParams(e);if(a.isValidationInvalid(t))throw this.logger.error(t.error.message),new Error(t.error.message)}))}validateRequest(e){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===e){const e=a.ERROR.MISSING_OR_INVALID.format({name:"request params"});throw this.logger.error(e.message),new Error(e.message)}const{topic:t,chainId:n}=e,r=yield this.settled.get(t);if(n&&!r.permissions.blockchain.chains.includes(n)){const e=a.ERROR.UNAUTHORIZED_TARGET_CHAIN.format({chainId:n});throw this.logger.error(e.message),new Error(e.message)}}))}validatePropose(e){return r.__awaiter(this,void 0,void 0,(function*(){if(void 0===e){const e=a.ERROR.MISSING_OR_INVALID.format({name:"propose params"});throw this.logger.error(e.message),new Error(e.message)}const t=a.validateSessionProposeParams(e);if(a.isValidationInvalid(t))throw this.logger.error(t.error.message),new Error(t.error.message);if(e.signal.method!==d.SESSION_SIGNAL_METHOD_PAIRING){const e=a.ERROR.UNSUPPORTED_SIGNAL.format({context:this.context});throw this.logger.error(e.message),new Error(e.message)}}))}getDefaultSignal(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=yield this.client.pairing.settled.get(e.topic);return{method:d.SESSION_SIGNAL_METHOD_PAIRING,params:{topic:t.topic}}}))}getDefaultTTL(){return r.__awaiter(this,void 0,void 0,(function*(){return d.SESSION_DEFAULT_TTL}))}getDefaultPermissions(){return r.__awaiter(this,void 0,void 0,(function*(){return{jsonrpc:{methods:[]},notifications:{types:[]},blockchain:{chains:[]}}}))}}t.Session=f},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Crypto=t.KeyChain=void 0;const r=n(8),i=r.__importStar(n(1)),o=n(15),s=n(14);t.KeyChain=class{constructor(e,t){this.client=e,this.storage=t,this.keychain=new Map,this.context=s.KEYCHAIN_CONTEXT,this.client=e,this.storage=t}init(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.restore()}))}has(e,t){return r.__awaiter(this,void 0,void 0,(function*(){return this.keychain.has(e)}))}set(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){this.keychain.set(e,t),yield this.persist()}))}get(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.keychain.get(e);if(void 0===t)throw new Error(o.ERROR.NO_MATCHING_KEY.format({tag:e}).message);return t}))}del(e,t){return r.__awaiter(this,void 0,void 0,(function*(){this.keychain.delete(e),yield this.persist()}))}getStorageKey(){return`${`${this.client.protocol}@${this.client.version}:${this.client.context}`}//${this.context}`}restore(){return r.__awaiter(this,void 0,void 0,(function*(){const e=yield this.storage.getItem(this.getStorageKey());void 0!==e&&(this.keychain=o.objToMap(e))}))}persist(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.storage.setItem(this.getStorageKey(),o.mapToObj(this.keychain))}))}};t.Crypto=class{constructor(e,t){this.client=e,this.keychain=t,this.context=s.CRYPTO_CONTEXT,this.client=e,this.keychain=t}init(){return r.__awaiter(this,void 0,void 0,(function*(){yield this.keychain.init()}))}hasKeys(e){return r.__awaiter(this,void 0,void 0,(function*(){return this.keychain.has(e)}))}generateKeyPair(){return r.__awaiter(this,void 0,void 0,(function*(){const e=o.generateKeyPair();return this.setKeyPair(e)}))}generateSharedKey(e,t,n){return r.__awaiter(this,void 0,void 0,(function*(){const r=yield this.getKeyPair(e.publicKey),i=o.deriveSharedKey(r.privateKey,t.publicKey);return this.setEncryptionKeys({sharedKey:i,publicKey:r.publicKey},n)}))}encrypt(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const{sharedKey:n,publicKey:r}=yield this.getEncryptionKeys(e);return yield o.encrypt({message:t,sharedKey:n,publicKey:r})}))}decrypt(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const{sharedKey:n}=yield this.getEncryptionKeys(e);return yield o.decrypt({encrypted:t,sharedKey:n})}))}concatKeys(e,t){return i.arrayToHex(i.concatArrays(i.hexToArray(e),i.hexToArray(t)))}splitKeys(e){const t=i.hexToArray(e);return[i.arrayToHex(t.slice(0,32)),i.arrayToHex(t.slice(32,64))]}setKeyPair(e){return r.__awaiter(this,void 0,void 0,(function*(){const t=this.concatKeys(e.publicKey,e.privateKey);return yield this.keychain.set(e.publicKey,t),e.publicKey}))}getKeyPair(e){return r.__awaiter(this,void 0,void 0,(function*(){const[t,n]=this.splitKeys(yield this.keychain.get(e));return{publicKey:e,privateKey:n}}))}setEncryptionKeys(e,t){return r.__awaiter(this,void 0,void 0,(function*(){const n=t||(yield o.sha256(e.sharedKey)),r=this.concatKeys(e.sharedKey,e.publicKey);return yield this.keychain.set(n,r),n}))}getEncryptionKeys(e){return r.__awaiter(this,void 0,void 0,(function*(){const[t,n]=this.splitKeys(yield this.keychain.get(e));return{sharedKey:t,publicKey:n}}))}}},function(e,t,n){"use strict";n.r(t),n.d(t,"JsonRpcProvider",(function(){return o}));var r=n(12),i=n(6);class o extends i.IJsonRpcProvider{constructor(e){super(e),this.events=new r.EventEmitter,this.connection=this.setConnection(e)}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,t){this.events.on(e,t)}once(e,t){this.events.once(e,t)}off(e,t){this.events.off(e,t)}removeListener(e,t){this.events.removeListener(e,t)}async request(e,t){return this.requestStrict(Object(i.formatJsonRpcRequest)(e.method,e.params||[]),t)}async requestStrict(e,t){return new Promise(async(n,r)=>{if(!this.connection.connected)try{await this.open()}catch(e){r(e)}this.events.on(""+e.id,e=>{Object(i.isJsonRpcError)(e)?r(e.error.message):n(e.result)});try{await this.connection.send(e,t)}catch(e){r(e)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),Object(i.isJsonRpcResponse)(e)?this.events.emit(""+e.id,e):this.events.emit("message",{type:e.method,data:e.params})}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),"string"==typeof e&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",()=>this.events.emit("disconnect")),this.connection.on("error",e=>this.events.emit("error",e)),this.events.emit("connect"))}async close(){await this.connection.close(),this.events.emit("disconnect")}}var s=o;t.default=s}])}));